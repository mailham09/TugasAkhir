(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{jkDv:function(t,e,n){"use strict";n.r(e),n.d(e,"AdminModule",function(){return jp});var r=n("ofXK"),i=n("fXoL"),o=n("tyNb"),s=n("/t3+"),a=n("bTqV"),u=n("NFeN"),c=n("XhcP"),h=n("MutI"),l=n("FKr1");function f(t,e){1&t&&(i.Ub(0,"mat-list-item",14),i.Ub(1,"mat-icon",15),i.yc(2,"audiotrack"),i.Tb(),i.Ub(3,"h3",16),i.yc(4,"Daftar lagu-lagu"),i.Tb(),i.Tb())}function d(t,e){if(1&t&&(i.Ub(0,"div"),i.Ub(1,"h3",12),i.yc(2),i.Tb(),i.xc(3,f,5,0,"mat-list-item",13),i.Tb()),2&t){const t=i.fc().$implicit;i.Db(2),i.zc(t.group),i.Db(1),i.kc("ngForOf",t.children)}}function p(t,e){1&t&&(i.Ub(0,"mat-list-item",17),i.Ub(1,"mat-icon",15),i.yc(2,"bookmark"),i.Tb(),i.Ub(3,"h3",16),i.yc(4,"About"),i.Tb(),i.Tb())}function g(t,e){if(1&t&&(i.Ub(0,"div"),i.xc(1,d,4,2,"div",10),i.xc(2,p,5,0,"mat-list-item",11),i.Tb()),2&t){const t=e.$implicit;i.Db(1),i.kc("ngIf",null!=t.children),i.Db(1),i.kc("ngIf",null==t.children)}}let y=(()=>{class t{constructor(t){this.router=t,this.loading=!0,this.menu=[{name:"Dashboard",icon:"anchor",url:"/admin/dashboard"},{group:"",children:[{name:"Product",icon:"supervisor_account",url:"/admin/product"}]}]}ngOnInit(){}logout(){confirm("Keluar aplikasi?")&&(localStorage.removeItem("appToken"),this.router.navigate(["/login"]))}}return t.\u0275fac=function(e){return new(e||t)(i.Ob(o.a))},t.\u0275cmp=i.Ib({type:t,selectors:[["app-admin"]],decls:21,vars:9,consts:[["color","primary",1,"example-header"],["mat-icon-button","",3,"click"],[1,"uk-width-expand"],["mat-button","",3,"click"],[1,"example-container"],["mode","side","opened","",1,"sidenav-left",3,"position","fixedInViewport","fixedTopGap","fixedBottomGap"],["sidenav",""],[4,"ngFor","ngForOf"],["mode","side",1,"example-sidenav",3,"position","fixedInViewport","fixedTopGap","fixedBottomGap"],[2,"padding","20px","background-color","rgb(100, 231, 88)"],[4,"ngIf"],["routerLink","/admin/dashboard",4,"ngIf"],["matSubheader",""],["routerLink","/admin/product",4,"ngFor","ngForOf"],["routerLink","/admin/product"],["matListIcon",""],["matLine",""],["routerLink","/admin/dashboard"]],template:function(t,e){if(1&t){const t=i.Vb();i.Sb(0),i.Ub(1,"mat-toolbar",0),i.Ub(2,"button",1),i.bc("click",function(){return i.rc(t),i.pc(14).toggle()}),i.Ub(3,"mat-icon"),i.yc(4,"menu"),i.Tb(),i.Tb(),i.Ub(5,"span"),i.yc(6,"Menu "),i.Tb(),i.Pb(7,"div",2),i.Ub(8,"small"),i.yc(9,"Admin"),i.Tb(),i.Ub(10,"button",3),i.bc("click",function(){return e.logout()}),i.yc(11,"Logout"),i.Tb(),i.Tb(),i.Ub(12,"mat-sidenav-container",4),i.Ub(13,"mat-sidenav",5,6),i.Ub(15,"mat-nav-list"),i.xc(16,g,3,2,"div",7),i.Tb(),i.Tb(),i.Pb(17,"mat-sidenav",8,6),i.Ub(19,"mat-sidenav-content",9),i.Pb(20,"router-outlet"),i.Tb(),i.Tb(),i.Rb()}2&t&&(i.Db(13),i.kc("position","start")("fixedInViewport",!0)("fixedTopGap",65)("fixedBottomGap",0),i.Db(3),i.kc("ngForOf",e.menu),i.Db(1),i.kc("position","end")("fixedInViewport",!0)("fixedTopGap",60)("fixedBottomGap",0))},directives:[s.a,a.a,u.a,c.b,c.a,h.e,r.j,c.c,o.d,r.k,h.d,h.b,o.b,h.a,l.j],styles:["body[_ngcontent-%COMP%]{background:-webkit-linear-gradient(bottom,#2dbd6e,#a6f77b);background-repeat:no-repeat}"]}),t})(),m=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Ib({type:t,selectors:[["app-dashboard"]],decls:56,vars:0,consts:[["lang","en"],["charset","UTF-8"],["name","viewport","content","width=device-width, initial-scale=1.0"],["href","https://www.youtube.com/watch?v=-Dl6CLWLMzk"],["href","https://www.youtube.com/watch?v=NvR60Wg9R7Q"],["href","https://www.youtube.com/watch?v=r0E8T9Ugvx8"],["href","https://www.youtube.com/watch?v=1w7OgIMMRc4"],["href","https://www.youtube.com/watch?v=r00ikilDxW4"],[2,"color","rgb(248, 250, 249)"],[2,"color","rgb(249, 252, 251)"],[2,"color","rgb(250, 250, 250)"],[2,"color","rgb(252, 253, 253)"],["src","https://cf.shopee.co.id/file/ffc674d04bb6acfa906d9edce5fd5593",2,"width","300px","height","300"],["src","https://id.yamaha.com/id/files/Image-main_Drums_6a5a43893da324eadb9da9f2d1010e98.jpg?impolicy=resize&imwid=1200&imhei=480",2,"width","400px","height","400"],["src","https://img.my-best.id/press_component/images/ae9916aba83d9393b5a57d07034a18d3.jpg?ixlib=rails-4.2.0&q=70&lossless=0&w=690&fit=max",2,"width","400px","height","400"],["src","https://e7.pngegg.com/pngimages/28/316/png-clipart-korg-musical-keyboard-music-workstation-electronic-keyboard-keyboard-electronics-piano.png",2,"width","400px","height","400"],[2,"text-align","center"]],template:function(t,e){1&t&&(i.Ub(0,"html",0),i.Ub(1,"head"),i.Pb(2,"meta",1),i.Pb(3,"meta",2),i.Ub(4,"title"),i.yc(5,"Dashboard "),i.Tb(),i.Tb(),i.Ub(6,"body"),i.Ub(7,"nav"),i.Ub(8,"a",3),i.yc(9,"Hellowen"),i.Tb(),i.Ub(10,"a",4),i.yc(11,"Bon Jovi"),i.Tb(),i.Ub(12,"a",5),i.yc(13,"SteelHeart"),i.Tb(),i.Ub(14,"a",6),i.yc(15,"Guns N'Roses"),i.Tb(),i.Ub(16,"a",7),i.yc(17,"Green Day"),i.Tb(),i.Tb(),i.Pb(18,"hr"),i.Ub(19,"article"),i.Ub(20,"h1",8),i.yc(21," ABOUT MUSIC "),i.Tb(),i.Ub(22,"p",9),i.yc(23," Musik sudah dikenal sejak adanyamanusia yaitu sekitar 180.000 hingga 100.000 tahun yang lalu. Tidak tercatat dalam sejarah siapa yang pertama mengenal musik. Alat musik yang tertua adalah flute terbuat dari tulang yang telah dilubangi. Flute tersebut diduga dibuat pada 40.000 tahun yang lalu "),i.Tb(),i.Ub(24,"p",10),i.yc(25," Musik Abad Pertengahan Pada masa ini seni musik sering digunakan untuk kegiatan gereja. Namun, setelah adanya berbagai penemuan-penemuan baru dalam segala bidang, fungsi musik juga berkembang tidak hanya untuk kegiatan agama. Pada zaman renaisance (1500-1600) muncul musik percintaan dan keperwiraan. Sehingga musik gereja mengalami kemunduran. Piano dan organ juga ditemukan pada zaman ini. Komposer yang hidup pada zaman ini adalah L\xe9onin, P\xe9rotin, dan Guillaume de Machaut. "),i.Tb(),i.Ub(26,"p",11),i.yc(27," Musik Zaman Barok dan Rokoko Pada zaman ini yaitu sekitar tahun 1600sampai 1750-an, ornamentik pada musik mulai digunakan. Pada musik Barok penggunaannya dilakukan secara spontan sedangkan pada musik Rokoko penggunaannya dicatat dan diatur. Musisiterkenal pada zaman ini adalah Johan Sebastian Bach, pencipta musik koral dan pencipta lagu-lagu instrumental. "),i.Tb(),i.Ub(28,"h2",8),i.yc(29,"BEBERAPA ALAT MUSIK"),i.Tb(),i.Ub(30,"h3",8),i.yc(31,"1.Gitar"),i.Tb(),i.Pb(32,"img",12),i.Pb(33,"br"),i.Ub(34,"p",8),i.yc(35," Kata \u2018gitar\u2019 atau guitar dalam bahasa Inggris, pada mulanya diambil dari nama alat musik petik kuno di wilayah Persia pada kira-kira tahun 1500 SM yang dikenal sebagai citar atau sehtar. Alat musik ini kemudian berkembang menjadi berbagai macam model gitar kuno yang dikenal dengan istilah umum tanbur. Pada tahun 300 SM Tanbur Persia dikembangkan oleh bangsa Yunani dan enam abad kemudian oleh bangsa Romawi (Bellow, 1970:54-55). Pada tahun 476M alat musik ini dibawa oleh bangsa Romawi ke Spanyol dan bertransformasi menjadi: (1) guitarra Morisca yang berfungsi sebagai pembawa melodi, dan (2) Guitarra Latina untuk memainkan akor. Tiga abad kemudian bangsa Arab membawa semacam gitar gambus dengan sebutan al ud ke Spanyol "),i.Tb(),i.Ub(36,"h3",8),i.yc(37,"2.Drum"),i.Tb(),i.Pb(38,"img",13),i.Pb(39,"br"),i.Ub(40,"p",8),i.yc(41," Drum merupakan salah satu alat musik tertua di dunia. Alat musik ini digunakan sebelum tahun 6000 SM (Sebelum Masehi). Dahulu bangsa Afrika menggunakan drum untuk bermain musik, mengiringi tarian pada upacara adat, tanda peringatan bahaya, maupun menginstruksikan pasukan maju ke medan perang. Namun tentu saja bentuknya tidak seperti sekarang. Pada awalnya drum hanya terdiri dari tom tom. Adanya invasi bangsa Eropa dan Timur Tengah ke Afrika menyebabkan drum semakin dikenal dan semakin berkembang sehingga tercipta snar drum.Sekira pada tahun 1800, drum-set dimainkan oleh beberapa musisi, masing-masing memainkan snare-drum,bass-drum, simbal, dan lain-lain yang tergabung di dalam sebuah grup musisi dengan banyak pemain atau big-band. Pada akhir tahun 1890, tata cara bermain drum-set mulai berubah. Semenjak musisi mulai bermain di tempat-tempat teater berukuran kecil, maka tidak memungkinkan bagi musisi untuk memainkan drum oleh 3 orang atau lebih pemain. Oleh sebab itu mereka berusaha untuk mengurangi jumlah pemain drums, misalnya seorang drummer memainkan beberapa alat perkusi. "),i.Tb(),i.Ub(42,"h3",8),i.yc(43,"3.Bass"),i.Tb(),i.Pb(44,"img",14),i.Pb(45,"br"),i.Ub(46,"p",8),i.yc(47," Gitar bas elektrik (biasa disebut gitar bas, bas elektrik atau bas saja) adalah alat musik dawai yang menggunakan listrik untuk memperbesar suaranya. Penampilannya mirip dengan gitar elektrik tetapi ia memiliki tubuh yang lebih besar, leher yang lebih panjang, dan umumnya memiliki empat senar (dibandingkan dengan gitar yang memiliki enam senar). Bas umumnya lebih berat daripada gitar elektrik biasa, karena senarnya yang lebih tebal (untuk menjangkau nada rendah) sehingga dibutuhkan material kayu yang lebih padat dan keras untuk menyeimbangkan tekanannya pada neck (leher gitar). "),i.Tb(),i.Ub(48,"h3",8),i.yc(49,"4.Keyboard"),i.Tb(),i.Pb(50,"img",15),i.Pb(51,"br"),i.Ub(52,"p",8),i.yc(53," Keyboard elektronik baru muncul pada abad ke-20. Pertama kali dipasarkan oleh Laurens Hammond di Amerika Serikat pada tahun 1935. Sejak saat itu mulai berkembang instrumen yang sekarang ini menjadi rajanya alat musik. Suara orkes simponi pun dengan puluhan instrumen bisa dihasilkan oleh satu buah Keyboard saja. "),i.Tb(),i.Tb(),i.Pb(54,"hr"),i.Pb(55,"footer",16),i.Tb(),i.Tb())},styles:["body[_ngcontent-%COMP%]{background-image:url(https://p4.wallpaperbetter.com/wallpaper/868/782/385/colorful-black-background-musical-notes-hd-wallpaper-preview.jpg)}"]}),t})();var v=n("hctd");let b=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Ib({type:t,selectors:[["app-images"]],decls:2,vars:0,template:function(t,e){1&t&&(i.Ub(0,"p"),i.yc(1,"images works!"),i.Tb())},styles:[""]}),t})();var w=n("0IaG"),T=n("D0XW"),I=n("HDdC"),E=n("Cfvw"),_=n("LRne"),O=n("JX91"),S=n("Zy1z"),k=n("lJxs"),D=n("Kqap"),A=n("/uUt"),N=n("pLZG"),j=n("pxpQ"),x=n("spgP"),C=n("Jgta"),R=n("zIRd"),P=n("mrSG"),L=n("qOnz"),M=n("q/0M"),U=function(t,e){return(U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function F(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var V,q="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},B=B||{},K=q||self;function G(){}function z(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function Q(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var H="closure_uid_"+(1e9*Math.random()>>>0),W=0;function Y(t,e,n){return t.call.apply(t.bind,arguments)}function X(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function $(t,e,n){return($=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Y:X).apply(null,arguments)}function J(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Z(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function tt(){this.s=this.s,this.o=this.o}var et={};tt.prototype.s=!1,tt.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,H)&&t[H]||(t[H]=++W)}(this);delete et[t]}},tt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var nt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},rt=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function it(t){return Array.prototype.concat.apply([],arguments)}function ot(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function st(t){return/^[\s\xa0]*$/.test(t)}var at,ut=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function ct(t,e){return-1!=t.indexOf(e)}function ht(t,e){return t<e?-1:t>e?1:0}t:{var lt=K.navigator;if(lt){var ft=lt.userAgent;if(ft){at=ft;break t}}at=""}function dt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function pt(t){var e={};for(var n in t)e[n]=t[n];return e}var gt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function yt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<gt.length;o++)n=gt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function mt(t){return mt[" "](t),t}mt[" "]=G;var vt,bt,wt=ct(at,"Opera"),Tt=ct(at,"Trident")||ct(at,"MSIE"),It=ct(at,"Edge"),Et=It||Tt,_t=ct(at,"Gecko")&&!(ct(at.toLowerCase(),"webkit")&&!ct(at,"Edge"))&&!(ct(at,"Trident")||ct(at,"MSIE"))&&!ct(at,"Edge"),Ot=ct(at.toLowerCase(),"webkit")&&!ct(at,"Edge");function St(){var t=K.document;return t?t.documentMode:void 0}t:{var kt="",Dt=(bt=at,_t?/rv:([^\);]+)(\)|;)/.exec(bt):It?/Edge\/([\d\.]+)/.exec(bt):Tt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(bt):Ot?/WebKit\/(\S+)/.exec(bt):wt?/(?:Version)[ \/]?(\S+)/.exec(bt):void 0);if(Dt&&(kt=Dt?Dt[1]:""),Tt){var At=St();if(null!=At&&At>parseFloat(kt)){vt=String(At);break t}}vt=kt}var Nt={};var jt=K.document&&Tt&&(St()||parseInt(vt,10))||void 0,xt=function(){if(!K.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{K.addEventListener("test",G,e),K.removeEventListener("test",G,e)}catch(n){}return t}();function Ct(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function Rt(t,e){if(Ct.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(_t){t:{try{mt(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Pt[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Rt.Z.h.call(this)}}Ct.prototype.h=function(){this.defaultPrevented=!0},Z(Rt,Ct);var Pt={2:"touch",3:"pen",4:"mouse"};Rt.prototype.h=function(){Rt.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Lt="closure_listenable_"+(1e6*Math.random()|0),Mt=0;function Ut(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++Mt,this.ca=this.fa=!1}function Ft(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function Vt(t){this.src=t,this.g={},this.h=0}function qt(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=nt(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Ft(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function Bt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}Vt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=Bt(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new Ut(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var Kt="closure_lm_"+(1e6*Math.random()|0),Gt={};function zt(t,e,n,r,i){if(r&&r.once)return Ht(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)zt(t,e[o],n,r,i);return null}return n=te(n),t&&t[Lt]?t.N(e,n,Q(r)?!!r.capture:!!r,i):Qt(t,e,n,!1,r,i)}function Qt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=Q(i)?!!i.capture:!!i,a=Jt(t);if(a||(t[Kt]=a=new Vt(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=$t;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)xt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Xt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ht(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)Ht(t,e[o],n,r,i);return null}return n=te(n),t&&t[Lt]?t.O(e,n,Q(r)?!!r.capture:!!r,i):Qt(t,e,n,!0,r,i)}function Wt(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)Wt(t,e[o],n,r,i);else r=Q(r)?!!r.capture:!!r,n=te(n),t&&t[Lt]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=Bt(o=t.g[e],n,r,i))&&(Ft(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.g[e],t.h--))):t&&(t=Jt(t))&&(e=t.g[e.toString()],t=-1,e&&(t=Bt(e,n,r,i)),(n=-1<t?e[t]:null)&&Yt(n))}function Yt(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[Lt])qt(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Xt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Jt(e))?(qt(n,t),0==n.h&&(n.src=null,e[Kt]=null)):Ft(t)}}}function Xt(t){return t in Gt?Gt[t]:Gt[t]="on"+t}function $t(t,e){if(t.ca)t=!0;else{e=new Rt(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&Yt(t),t=n.call(r,e)}return t}function Jt(t){return(t=t[Kt])instanceof Vt?t:null}var Zt="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(t){return"function"==typeof t?t:(t[Zt]||(t[Zt]=function(e){return t.handleEvent(e)}),t[Zt])}function ee(){tt.call(this),this.i=new Vt(this),this.P=this,this.I=null}function ne(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new Ct(e,t);else if(e instanceof Ct)e.target=e.target||t;else{var i=e;yt(e=new Ct(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.g=n[o];i=re(s,r,!0,e)&&i}if(i=re(s=e.g=t,r,!0,e)&&i,i=re(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=re(s=e.g=n[o],r,!1,e)&&i}function re(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.ca&&s.capture==n){var a=s.listener,u=s.ia||s.src;s.fa&&qt(t.i,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}Z(ee,tt),ee.prototype[Lt]=!0,ee.prototype.removeEventListener=function(t,e,n,r){Wt(this,t,e,n,r)},ee.prototype.M=function(){if(ee.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Ft(n[r]);delete e.g[t],e.h--}}this.I=null},ee.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},ee.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var ie=K.JSON.stringify;function oe(){var t=de,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var se,ae=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=ue.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),ue=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,this.g=(t=this.g).next,t.next=null):t=this.i(),t},t}())(function(){return new ce},function(t){return t.reset()}),ce=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function he(t){K.setTimeout(function(){throw t},0)}function le(t,e){se||function(){var t=K.Promise.resolve(void 0);se=function(){t.then(pe)}}(),fe||(se(),fe=!0),de.add(t,e)}var fe=!1,de=new ae;function pe(){for(var t;t=oe();){try{t.h.call(t.g)}catch(n){he(n)}var e=ue;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}fe=!1}function ge(t,e){ee.call(this),this.h=t||1,this.g=e||K,this.j=$(this.kb,this),this.l=Date.now()}function ye(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function me(t,e,n){if("function"==typeof t)n&&(t=$(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=$(t.handleEvent,t)}return 2147483647<Number(e)?-1:K.setTimeout(t,e||0)}function ve(t){t.g=me(function(){t.g=null,t.i&&(t.i=!1,ve(t))},t.j);var e=t.h;t.h=null,t.m.apply(null,e)}Z(ge,ee),(V=ge.prototype).da=!1,V.S=null,V.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),ne(this,"tick"),this.da&&(ye(this),this.start()))}},V.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},V.M=function(){ge.Z.M.call(this),ye(this),delete this.g};var be=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}U(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:ve(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(K.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(tt);function we(t){tt.call(this),this.h=t,this.g={}}Z(we,tt);var Te=[];function Ie(t,e,n,r){Array.isArray(n)||(n&&(Te[0]=n.toString()),n=Te);for(var i=0;i<n.length;i++){var o=zt(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function Ee(t){dt(t.g,function(t,e){this.g.hasOwnProperty(e)&&Yt(t)},t),t.g={}}function _e(){this.g=!0}function Oe(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return ie(n)}catch(a){return e}}(t,n)+(r?" "+r:"")})}we.prototype.M=function(){we.Z.M.call(this),Ee(this)},we.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},_e.prototype.Aa=function(){this.g=!1},_e.prototype.info=function(){};var Se={},ke=null;function De(){return ke=ke||new ee}function Ae(t){Ct.call(this,Se.Ma,t)}function Ne(t){var e=De();ne(e,new Ae(e,t))}function je(t,e){Ct.call(this,Se.STAT_EVENT,t),this.stat=e}function xe(t){var e=De();ne(e,new je(e,t))}function Ce(t,e){Ct.call(this,Se.Na,t),this.size=e}function Re(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return K.setTimeout(function(){t()},e)}Se.Ma="serverreachability",Z(Ae,Ct),Se.STAT_EVENT="statevent",Z(je,Ct),Se.Na="timingevent",Z(Ce,Ct);var Pe={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Le={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Me(){}function Ue(){}Me.prototype.h=null;var Fe,Ve={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function qe(){Ct.call(this,"d")}function Be(){Ct.call(this,"c")}function Ke(){}function Ge(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new we(this),this.P=Qe,this.W=new ge(t=Et?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new ze}function ze(){this.i=null,this.g="",this.h=!1}Z(qe,Ct),Z(Be,Ct),Z(Ke,Me),Ke.prototype.g=function(){return new XMLHttpRequest},Ke.prototype.i=function(){return{}},Fe=new Ke;var Qe=45e3,He={},We={};function Ye(t,e,n){t.K=1,t.v=bn(dn(e)),t.s=n,t.U=!0,Xe(t,null)}function Xe(t,e){t.F=Date.now(),tn(t),t.A=dn(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),xn(n.h,"t",r),t.C=0,n=t.l.H,t.h=new ze,t.g=Cr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new be($(t.Ia,t,t.g),t.O)),Ie(t.V,t.g,"readystatechange",t.gb),e=t.H?pt(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),Ne(1),function(t,e,n,r,i,o){t.info(function(){if(t.g)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s})}(t.j,t.u,t.A,t.m,t.X,t.s)}function $e(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function Je(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=Ze(t,n))==We){4==e&&(t.o=4,xe(14),i=!1),Oe(t.j,t.m,null,"[Incomplete Response]");break}if(r==He){t.o=4,xe(15),Oe(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}Oe(t.j,t.m,r,null),sn(t,r)}$e(t)&&r!=We&&r!=He&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,xe(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Or(e),e.L=!0,xe(11))):(Oe(t.j,t.m,n,"[Invalid Chunked Response]"),on(t),rn(t))}function Ze(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?We:(n=Number(e.substring(n,r)),isNaN(n)?He:(r+=1)+n>e.length?We:(e=e.substr(r,n),t.C=r+n,e))}function tn(t){t.Y=Date.now()+t.P,en(t,t.P)}function en(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Re($(t.eb,t),e)}function nn(t){t.B&&(K.clearTimeout(t.B),t.B=null)}function rn(t){0==t.l.G||t.I||Dr(t.l,t)}function on(t){nn(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,ye(t.W),Ee(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function sn(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Fn(n.i,t)))if(n.I=t.N,!t.J&&Fn(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;kr(n),yr(n)}_r(n),xe(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=Re($(n.ab,n),6e3));if(1>=Un(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else Nr(n,11)}else if((t.J||n.g==t)&&kr(n),!st(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var s=o[3];null!=s&&(n.ma=s,n.h.info("VER="+n.ma));var a=o[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var u=o[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=t.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(ct(h,"spdy")||ct(h,"quic")||ct(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(Vn(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,vn(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=t;if((r=n).oa=xr(r,r.H?r.la:null,r.W),d.J){qn(r.i,d);var p=d,g=r.K;g&&p.setTimeout(g),p.B&&(nn(p),tn(p)),r.g=d}else Er(r);0<n.l.length&&br(n)}else"stop"!=o[0]&&"close"!=o[0]||Nr(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?Nr(n,7):gr(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}Ne(4)}catch(o){}}function an(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(z(t)||"string"==typeof t)rt(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(z(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(z(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function un(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof un)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function cn(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];hn(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)hn(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function hn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(V=Ge.prototype).setTimeout=function(t){this.P=t},V.gb=function(t){t=t.target;var e=this.L;e&&3==hr(t)?e.l():this.Ia(t)},V.Ia=function(t){try{if(t==this.g)t:{var e=hr(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||Et||this.g&&(this.h.h||this.g.ga()||lr(this.g)))){this.I||4!=e||7==n||Ne(8==n||0>=r?3:2),nn(this);var i=this.g.ba();this.N=i;e:if($e(this)){var o=lr(this.g);t="";var s=o.length,a=4==hr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){on(this),rn(this);var u="";break e}this.h.i=new K.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:a&&n==s-1});o.splice(0,s),this.h.g+=t,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,s){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s})}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!st(c)){var l=c;break e}}l=null}if(!(i=l)){this.i=!1,this.o=3,xe(12),on(this),rn(this);break t}Oe(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,sn(this,i)}this.U?(Je(this,e,u),Et&&this.i&&3==e&&(Ie(this.V,this.W,"tick",this.fb),this.W.start())):(Oe(this.j,this.m,u,null),sn(this,u)),4==e&&on(this),this.i&&!this.I&&(4==e?Dr(this.l,this):(this.i=!1,tn(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,xe(12)):(this.o=0,xe(13)),on(this),rn(this)}}}catch(e){}},V.fb=function(){if(this.g){var t=hr(this.g),e=this.g.ga();this.C<e.length&&(nn(this),Je(this,t,e),this.i&&4!=t&&tn(this))}},V.cancel=function(){this.I=!0,on(this)},V.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(Ne(3),xe(17)),on(this),this.o=2,rn(this)):en(this,this.Y-t)},(V=un.prototype).R=function(){cn(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},V.T=function(){return cn(this),this.g.concat()},V.get=function(t,e){return hn(this.h,t)?this.h[t]:e},V.set=function(t,e){hn(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},V.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var ln=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function fn(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof fn){this.g=void 0!==e?e:t.g,pn(this,t.j),this.s=t.s,gn(this,t.i),yn(this,t.m),this.l=t.l,e=t.h;var n=new Dn;n.i=e.i,e.g&&(n.g=new un(e.g),n.h=e.h),mn(this,n),this.o=t.o}else t&&(n=String(t).match(ln))?(this.g=!!e,pn(this,n[1]||"",!0),this.s=wn(n[2]||""),gn(this,n[3]||"",!0),yn(this,n[4]),this.l=wn(n[5]||"",!0),mn(this,n[6]||"",!0),this.o=wn(n[7]||"")):(this.g=!!e,this.h=new Dn(null,this.g))}function dn(t){return new fn(t)}function pn(t,e,n){t.j=n?wn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function gn(t,e,n){t.i=n?wn(e,!0):e}function yn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function mn(t,e,n){e instanceof Dn?(t.h=e,function(t,e){e&&!t.j&&(An(t),t.i=null,t.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Nn(this,e),xn(this,n,t))},t)),t.j=e}(t.h,t.g)):(n||(e=Tn(e,Sn)),t.h=new Dn(e,t.g))}function vn(t,e,n){t.h.set(e,n)}function bn(t){return vn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function wn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Tn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,In),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function In(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}fn.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Tn(e,En,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Tn(e,En,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(Tn(n,"/"==n.charAt(0)?On:_n,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Tn(n,kn)),t.join("")};var En=/[#\/\?@]/g,_n=/[#\?:]/g,On=/[#\?]/g,Sn=/[#\?@]/g,kn=/#/g;function Dn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function An(t){t.g||(t.g=new un,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function Nn(t,e){An(t),e=Cn(t,e),hn(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,hn((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&cn(t)))}function jn(t,e){return An(t),e=Cn(t,e),hn(t.g.h,e)}function xn(t,e,n){Nn(t,e),0<n.length&&(t.i=null,t.g.set(Cn(t,e),ot(n)),t.h+=n.length)}function Cn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(V=Dn.prototype).add=function(t,e){An(this),this.i=null,t=Cn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},V.forEach=function(t,e){An(this),this.g.forEach(function(n,r){rt(n,function(n){t.call(e,n,r,this)},this)},this)},V.T=function(){An(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},V.R=function(t){An(this);var e=[];if("string"==typeof t)jn(this,t)&&(e=it(e,this.g.get(Cn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=it(e,t[n])}return e},V.set=function(t,e){return An(this),this.i=null,jn(this,t=Cn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},V.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},V.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.i=t.join("&")};var Rn=function(){return function(t,e){this.h=t,this.g=e}}();function Pn(t){this.l=t||Ln,t=K.PerformanceNavigationTiming?0<(t=K.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(K.g&&K.g.Ea&&K.g.Ea()&&K.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Ln=10;function Mn(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Un(t){return t.h?1:t.g?t.g.size:0}function Fn(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Vn(t,e){t.g?t.g.add(e):t.h=e}function qn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Bn(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=F(t.g.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.D)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return ot(t.i)}function Kn(){}function Gn(){this.g=new Kn}function zn(t,e,n){var r=n||"";try{an(t,function(t,n){var i=t;Q(t)&&(i=ie(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(tp){throw e.push(r+"type="+encodeURIComponent("_badmap")),tp}}function Qn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}function Hn(t){this.l=t.$b||null,this.j=t.ib||!1}function Wn(t,e){ee.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Yn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Pn.prototype.cancel=function(){var t,e;if(this.i=Bn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=F(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},Kn.prototype.stringify=function(t){return K.JSON.stringify(t,void 0)},Kn.prototype.parse=function(t){return K.JSON.parse(t,void 0)},Z(Hn,Me),Hn.prototype.g=function(){return new Wn(this.l,this.j)},Hn.prototype.i=function(t){return function(){return t}}({}),Z(Wn,ee);var Yn=0;function Xn(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function $n(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Jn(t)}function Jn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(V=Wn.prototype).open=function(t,e){if(this.readyState!=Yn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Jn(this)},V.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||K).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},V.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,$n(this)),this.readyState=Yn},V.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Jn(this)),this.g&&(this.readyState=3,Jn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==K.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Xn(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},V.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?$n(this):Jn(this),3==this.readyState&&Xn(this)}},V.Ua=function(t){this.g&&(this.response=this.responseText=t,$n(this))},V.Ta=function(t){this.g&&(this.response=t,$n(this))},V.ha=function(){this.g&&$n(this)},V.setRequestHeader=function(t,e){this.v.append(t,e)},V.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},V.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Wn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Zn=K.JSON.parse;function tr(t){ee.call(this),this.headers=new un,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=er,this.K=this.L=!1}Z(tr,ee);var er="",nr=/^https?$/i,rr=["POST","PUT"];function ir(t){return"content-type"==t.toLowerCase()}function or(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,sr(t),ur(t)}function sr(t){t.D||(t.D=!0,ne(t,"complete"),ne(t,"error"))}function ar(t){if(t.h&&void 0!==B&&(!t.C[1]||4!=hr(t)||2!=t.ba()))if(t.v&&4==hr(t))me(t.Fa,0,t);else if(ne(t,"readystatechange"),4==hr(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(ln)[1]||null;if(!o&&K.self&&K.self.location){var s=K.self.location.protocol;o=s.substr(0,s.length-1)}i=!nr.test(o?o.toLowerCase():"")}e=i}if(e)ne(t,"complete"),ne(t,"success");else{t.m=6;try{var a=2<hr(t)?t.g.statusText:""}catch(u){a=""}t.j=a+" ["+t.ba()+"]",sr(t)}}finally{ur(t)}}}function ur(t,e){if(t.g){cr(t);var n=t.g,r=t.C[0]?G:null;t.g=null,t.C=null,e||ne(t,"ready");try{n.onreadystatechange=r}catch(tp){}}}function cr(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(K.clearTimeout(t.A),t.A=null)}function hr(t){return t.g?t.g.readyState:0}function lr(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case er:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function fr(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return dt(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):vn(t,e,n))}function dr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function pr(t){this.za=0,this.l=[],this.h=new _e,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=dr("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=dr("baseRetryDelayMs",5e3,t),this.$a=dr("retryDelaySeedMs",1e4,t),this.Ya=dr("forwardChannelMaxRetries",2,t),this.ra=dr("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new Pn(t&&t.concurrentRequestLimit),this.Ca=new Gn,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function gr(t){if(mr(t),3==t.G){var e=t.V++,n=dn(t.F);vn(n,"SID",t.J),vn(n,"RID",e),vn(n,"TYPE","terminate"),Tr(t,n),(e=new Ge(t,t.h,e,void 0)).K=2,e.v=bn(dn(n)),n=!1,K.navigator&&K.navigator.sendBeacon&&(n=K.navigator.sendBeacon(e.v.toString(),"")),!n&&K.Image&&((new Image).src=e.v,n=!0),n||(e.g=Cr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),tn(e)}jr(t)}function yr(t){t.g&&(Or(t),t.g.cancel(),t.g=null)}function mr(t){yr(t),t.u&&(K.clearTimeout(t.u),t.u=null),kr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&K.clearTimeout(t.m),t.m=null)}function vr(t,e){t.l.push(new Rn(t.Za++,e)),3==t.G&&br(t)}function br(t){Mn(t.i)||t.m||(t.m=!0,le(t.Ha,t),t.C=0)}function wr(t,e){var n;n=e?e.m:t.V++;var r=dn(t.F);vn(r,"SID",t.J),vn(r,"RID",n),vn(r,"AID",t.U),Tr(t,r),t.o&&t.s&&fr(r,t.o,t.s),n=new Ge(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=Ir(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),Vn(t.i,n),Ye(n,r,e)}function Tr(t,e){t.j&&an({},function(t,n){vn(e,n,t)})}function Ir(t,e,n){n=Math.min(t.l.length,n);var r=t.j?$(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].h)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if(0>(c-=o))o=Math.max(0,i[u].h-100),a=!1;else try{zn(h,s,"req"+c+"_")}catch(di){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function Er(t){t.g||t.u||(t.Y=1,le(t.Ga,t),t.A=0)}function _r(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=Re($(t.Ga,t),Ar(t,t.A)),t.A++,0))}function Or(t){null!=t.B&&(K.clearTimeout(t.B),t.B=null)}function Sr(t){t.g=new Ge(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=dn(t.oa);vn(e,"RID","rpc"),vn(e,"SID",t.J),vn(e,"CI",t.N?"0":"1"),vn(e,"AID",t.U),Tr(t,e),vn(e,"TYPE","xmlhttp"),t.o&&t.s&&fr(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=bn(dn(e)),n.s=null,n.U=!0,Xe(n,t)}function kr(t){null!=t.v&&(K.clearTimeout(t.v),t.v=null)}function Dr(t,e){var n=null;if(t.g==e){kr(t),Or(t),t.g=null;var r=2}else{if(!Fn(t.i,e))return;n=e.D,qn(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;ne(r=De(),new Ce(r,n,e,i)),br(t)}else Er(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(Un(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=Re($(t.Ha,t,e),Ar(t,t.C)),t.C++,0)))}(t,e)||2==r&&_r(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:Nr(t,5);break;case 4:Nr(t,10);break;case 3:Nr(t,6);break;default:Nr(t,2)}}function Ar(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function Nr(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=$(t.jb,t);n||(n=new fn("//www.google.com/images/cleardot.gif"),K.location&&"http"==K.location.protocol||pn(n,"https"),bn(n)),function(t,e){var n=new _e;if(K.Image){var r=new Image;r.onload=J(Qn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=J(Qn,n,r,"TestLoadImage: error",!1,e),r.onabort=J(Qn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=J(Qn,n,r,"TestLoadImage: timeout",!1,e),K.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else xe(2);t.G=0,t.j&&t.j.va(e),jr(t),mr(t)}function jr(t){t.G=0,t.I=-1,t.j&&(0==Bn(t.i).length&&0==t.l.length||(t.i.i.length=0,ot(t.l),t.l.length=0),t.j.ua())}function xr(t,e,n){var r=function(t){return t instanceof fn?dn(t):new fn(t,void 0)}(n);if(""!=r.i)e&&gn(r,e+"."+r.i),yn(r,r.m);else{var i=K.location;r=function(t,e,n,r){var i=new fn(null,void 0);return t&&pn(i,t),e&&gn(i,e),n&&yn(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&dt(t.aa,function(t,e){vn(r,e,t)}),n=t.sa,(e=t.D)&&n&&vn(r,e,n),vn(r,"VER",t.ma),Tr(t,r),r}function Cr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new tr(n&&t.Ba&&!t.qa?new Hn({ib:!0}):t.qa)).L=t.H,e}function Rr(){}function Pr(){if(Tt&&!(10<=Number(jt)))throw Error("Environmental error: no available transport.")}function Lr(t,e){ee.call(this),this.g=new pr(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!st(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!st(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Fr(this)}function Mr(t){qe.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Ur(){Be.call(this),this.status=1}function Fr(t){this.g=t}(V=tr.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Fe.g(),this.C=function(t){return t.h||(t.h=t.i())}(this.u?this.u:Fe),this.g.onreadystatechange=$(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(o){return void or(this,o)}t=n||"";var i=new un(this.headers);r&&an(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=ir,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=K.FormData&&t instanceof K.FormData,!(0<=nt(rr,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.g.setRequestHeader(e,t)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{cr(this),0<this.B&&((this.K=function(t){return Tt&&function(){return t=Nt,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){for(var t=0,e=ut(String(vt)).split("."),n=ut("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=ht(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||ht(0==o[2].length,0==s[2].length)||ht(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}();var t}()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=$(this.pa,this)):this.A=me(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(o){or(this,o)}},V.pa=function(){void 0!==B&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ne(this,"timeout"),this.abort(8))},V.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,ne(this,"complete"),ne(this,"abort"),ur(this))},V.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ur(this,!0)),tr.Z.M.call(this)},V.Fa=function(){this.s||(this.F||this.v||this.l?ar(this):this.cb())},V.cb=function(){ar(this)},V.ba=function(){try{return 2<hr(this)?this.g.status:-1}catch(bt){return-1}},V.ga=function(){try{return this.g?this.g.responseText:""}catch(bt){return""}},V.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Zn(e)}},V.Da=function(){return this.m},V.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(V=pr.prototype).ma=8,V.G=1,V.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(e){}},V.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new Ge(this,this.h,t,void 0),n=this.s;if(this.P&&(n?yt(n=pt(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=Ir(this,e,r),vn(i=dn(this.F),"RID",t),vn(i,"CVER",22),this.D&&vn(i,"X-HTTP-Session-Id",this.D),Tr(this,i),this.o&&n&&fr(i,this.o,n),Vn(this.i,e),this.Ra&&vn(i,"TYPE","init"),this.ja?(vn(i,"$req",r),vn(i,"SID","null"),e.$=!0,Ye(e,i,null)):Ye(e,i,r),this.G=2}}else 3==this.G&&(t?wr(this,t):0==this.l.length||Mn(this.i)||wr(this))},V.Ga=function(){if(this.u=null,Sr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=Re($(this.bb,this),t)}},V.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,xe(10),yr(this),Sr(this))},V.ab=function(){null!=this.v&&(this.v=null,yr(this),_r(this),xe(19))},V.jb=function(t){t?(this.h.info("Successfully pinged google.com"),xe(2)):(this.h.info("Failed to ping google.com"),xe(1))},(V=Rr.prototype).xa=function(){},V.wa=function(){},V.va=function(){},V.ua=function(){},V.Oa=function(){},Pr.prototype.g=function(t,e){return new Lr(t,e)},Z(Lr,ee),Lr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),le($(t.hb,t,e))),xe(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=xr(t,null,t.W),br(t)},Lr.prototype.close=function(){gr(this.g)},Lr.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,vr(this.g,e)}else this.v?((e={}).__data__=ie(t),vr(this.g,e)):vr(this.g,t)},Lr.prototype.M=function(){this.g.j=null,delete this.j,gr(this.g),delete this.g,Lr.Z.M.call(this)},Z(Mr,qe),Z(Ur,Be),Z(Fr,Rr),Fr.prototype.xa=function(){ne(this.g,"a")},Fr.prototype.wa=function(t){ne(this.g,new Mr(t))},Fr.prototype.va=function(t){ne(this.g,new Ur(t))},Fr.prototype.ua=function(){ne(this.g,"b")},Pr.prototype.createWebChannel=Pr.prototype.g,Lr.prototype.send=Lr.prototype.u,Lr.prototype.open=Lr.prototype.m,Lr.prototype.close=Lr.prototype.close,Pe.NO_ERROR=0,Pe.TIMEOUT=8,Pe.HTTP_ERROR=6,Le.COMPLETE="complete",Ue.EventType=Ve,Ve.OPEN="a",Ve.CLOSE="b",Ve.ERROR="c",Ve.MESSAGE="d",ee.prototype.listen=ee.prototype.N,tr.prototype.listenOnce=tr.prototype.O,tr.prototype.getLastError=tr.prototype.La,tr.prototype.getLastErrorCode=tr.prototype.Da,tr.prototype.getStatus=tr.prototype.ba,tr.prototype.getResponseJson=tr.prototype.Qa,tr.prototype.getResponseText=tr.prototype.ga,tr.prototype.send=tr.prototype.ea;var Vr=Pe,qr=Le,Br=Se,Kr=Hn,Gr=Ue,zr=tr,Qr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();Qr.o=-1;var Hr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Wr=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(P.c)(e,t),e}(Error),Yr=new M.b("@firebase/firestore");function Xr(){return Yr.logLevel}function $r(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Yr.logLevel<=M.a.DEBUG){var r=e.map(ti);Yr.debug.apply(Yr,Object(P.f)(["Firestore (8.7.0): "+t],r))}}function Jr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Yr.logLevel<=M.a.ERROR){var r=e.map(ti);Yr.error.apply(Yr,Object(P.f)(["Firestore (8.7.0): "+t],r))}}function Zr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Yr.logLevel<=M.a.WARN){var r=e.map(ti);Yr.warn.apply(Yr,Object(P.f)(["Firestore (8.7.0): "+t],r))}}function ti(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(tp){return t}}function ei(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.7.0) INTERNAL ASSERTION FAILED: "+t;throw Jr(e),new Error(e)}function ni(t,e){t||ei()}function ri(t,e){return t}function ii(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var oi=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=ii(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function si(t,e){return t<e?-1:t>e?1:0}function ai(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function ui(t){return t+"\0"}var ci=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Wr(Hr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Wr(Hr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Wr(Hr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Wr(Hr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?si(this.nanoseconds,t.nanoseconds):si(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),hi=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new ci(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function li(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function fi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function di(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var pi=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&ei(),void 0===n?n=t.length-e:n>t.length-e&&ei(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),gi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(P.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(pi),yi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,mi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(P.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return yi.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new Wr(Hr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Wr(Hr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new Wr(Hr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(pi),vi=function(){function t(t){this.fields=t,t.sort(mi.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return ai(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),bi=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return si(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();bi.EMPTY_BYTE_STRING=new bi("");var wi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ti(t){if(ni(!!t),"string"==typeof t){var e=0,n=wi.exec(t);if(ni(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Ii(t.seconds),nanos:Ii(t.nanos)}}function Ii(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Ei(t){return"string"==typeof t?bi.fromBase64String(t):bi.fromUint8Array(t)}function _i(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Oi(t){var e=t.mapValue.fields.__previous_value__;return _i(e)?Oi(e):e}function Si(t){var e=Ti(t.mapValue.fields.__local_write_time__.timestampValue);return new ci(e.seconds,e.nanos)}function ki(t){return null==t}function Di(t){return 0===t&&1/t==-1/0}function Ai(t){return"number"==typeof t&&Number.isInteger(t)&&!Di(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Ni=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(gi.fromString(e))},t.fromName=function(e){return new t(gi.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===gi.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return gi.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new gi(e.slice()))},t}();function ji(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?_i(t)?4:10:ei()}function xi(t,e){var n=ji(t);if(n!==ji(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Si(t).isEqual(Si(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Ti(t.timestampValue),r=Ti(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Ei(t.bytesValue).isEqual(Ei(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Ii(t.geoPointValue.latitude)===Ii(e.geoPointValue.latitude)&&Ii(t.geoPointValue.longitude)===Ii(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ii(t.integerValue)===Ii(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Ii(t.doubleValue),r=Ii(e.doubleValue);return n===r?Di(n)===Di(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return ai(t.arrayValue.values||[],e.arrayValue.values||[],xi);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(li(n)!==li(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!xi(n[i],r[i])))return!1;return!0}(t,e);default:return ei()}}function Ci(t,e){return void 0!==(t.values||[]).find(function(t){return xi(t,e)})}function Ri(t,e){var n=ji(t),r=ji(e);if(n!==r)return si(n,r);switch(n){case 0:return 0;case 1:return si(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Ii(t.integerValue||t.doubleValue),r=Ii(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Pi(t.timestampValue,e.timestampValue);case 4:return Pi(Si(t),Si(e));case 5:return si(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Ei(t),r=Ei(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=si(n[i],r[i]);if(0!==o)return o}return si(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=si(Ii(t.latitude),Ii(e.latitude));return 0!==n?n:si(Ii(t.longitude),Ii(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Ri(n[i],r[i]);if(o)return o}return si(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=si(r[s],o[s]);if(0!==a)return a;var u=Ri(n[r[s]],i[o[s]]);if(0!==u)return u}return si(r.length,o.length)}(t.mapValue,e.mapValue);default:throw ei()}}function Pi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return si(t,e);var n=Ti(t),r=Ti(e),i=si(n.seconds,r.seconds);return 0!==i?i:si(n.nanos,r.nanos)}function Li(t){return Mi(t)}function Mi(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=Ti(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Ei(t.bytesValue).toBase64():"referenceValue"in t?Ni.fromName(t.referenceValue).toString():"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=Mi(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+Mi(t.fields[o])}return e+"}"}(t.mapValue):ei();var e}function Ui(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Fi(t){return!!t&&"integerValue"in t}function Vi(t){return!!t&&"arrayValue"in t}function qi(t){return!!t&&"nullValue"in t}function Bi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ki(t){return!!t&&"mapValue"in t}function Gi(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue)return{timestampValue:Object.assign({},Ti(t.timestampValue))};if(t.mapValue){var e={mapValue:{fields:{}}};return fi(t.mapValue.fields,function(t,n){return e.mapValue.fields[t]=Gi(n)}),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Gi(t.arrayValue.values[r]);return n}return Object.assign({},t)}var zi=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!Ki(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Gi(e)},t.prototype.setAll=function(t){var e=this,n=mi.emptyPath(),r={},i=[];t.forEach(function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=Gi(t):i.push(o.lastSegment())});var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());Ki(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return xi(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];Ki(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){fi(e,function(e,n){return t[e]=n});for(var r=0,i=n;r<i.length;r++)delete t[i[r]]},t.prototype.clone=function(){return new t(Gi(this.value))},t}();function Qi(t){var e=[];return fi(t.fields,function(t,n){var r=new mi([t]);if(Ki(n)){var i=Qi(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)}),new vi(e)}var Hi=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,hi.min(),zi.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,zi.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,zi.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=zi.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=zi.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),Wi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Yi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Wi(t,e,n,r,i,o,s)}function Xi(t){var e=ri(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+Li(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),ki(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=co(e.startAt)),e.endAt&&(n+="|ub:",n+=co(e.endAt)),e.h=n}return e.h}function $i(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!lo(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!xi(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!po(t.startAt,e.startAt)&&po(t.endAt,e.endAt)}function Ji(t){return Ni.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Zi=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(P.c)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new to(t,n,r):"array-contains"===n?new io(t,r):"in"===n?new oo(t,r):"not-in"===n?new so(t,r):"array-contains-any"===n?new ao(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new eo(t,n):new no(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(Ri(e,this.value)):null!==e&&ji(this.value)===ji(e)&&this.m(Ri(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return ei()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),to=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Ni.fromName(r.referenceValue),i}return Object(P.c)(e,t),e.prototype.matches=function(t){var e=Ni.comparator(t.key,this.key);return this.m(e)},e}(Zi),eo=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=ro(0,n),r}return Object(P.c)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(Zi),no=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=ro(0,n),r}return Object(P.c)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(Zi);function ro(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return Ni.fromName(t.referenceValue)})}var io=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(P.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return Vi(e)&&Ci(e.arrayValue,this.value)},e}(Zi),oo=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(P.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&Ci(this.value.arrayValue,e)},e}(Zi),so=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(P.c)(e,t),e.prototype.matches=function(t){if(Ci(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!Ci(this.value.arrayValue,e)},e}(Zi),ao=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(P.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!Vi(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return Ci(e.value.arrayValue,t)})},e}(Zi),uo=function(t,e){this.position=t,this.before=e};function co(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return Li(t)}).join(",")}var ho=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function lo(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function fo(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Ni.comparator(Ni.fromName(s.referenceValue),n.key):Ri(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function po(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!xi(t.position[n],e.position[n]))return!1;return!0}var go=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function yo(t,e,n,r,i,o,s,a){return new go(t,e,n,r,i,o,s,a)}function mo(t){return new go(t)}function vo(t){return!ki(t.limit)&&"F"===t.limitType}function bo(t){return!ki(t.limit)&&"L"===t.limitType}function wo(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function To(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Io(t){return null!==t.collectionGroup}function Eo(t){var e=ri(t);if(null===e.p){e.p=[];var n=To(e),r=wo(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new ho(n)),e.p.push(new ho(mi.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new ho(mi.keyField(),u))}}}return e.p}function _o(t){var e=ri(t);if(!e.T)if("F"===e.limitType)e.T=Yi(e.path,e.collectionGroup,Eo(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Eo(e);r<i.length;r++){var o=i[r];n.push(new ho(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new uo(e.endAt.position,!e.endAt.before):null,a=e.startAt?new uo(e.startAt.position,!e.startAt.before):null;e.T=Yi(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function Oo(t,e,n){return new go(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function So(t,e){return $i(_o(t),_o(e))&&t.limitType===e.limitType}function ko(t){return Xi(_o(t))+"|lt:"+t.limitType}function Do(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+Li(e.value);var e}).join(", ")+"]"),ki(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+co(t.startAt)),t.endAt&&(e+=", endAt: "+co(t.endAt)),"Target("+e+")"}(_o(t))+"; limitType="+t.limitType+")"}function Ao(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Ni.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!fo(t.startAt,Eo(t),e)||t.endAt&&fo(t.endAt,Eo(t),e))}(t,e)}function No(t){return function(e,n){for(var r=!1,i=0,o=Eo(t);i<o.length;i++){var s=o[i],a=jo(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function jo(t,e,n){var r=t.field.isKeyField()?Ni.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Ri(r,i):ei()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return ei()}}function xo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Di(e)?"-0":e}}function Co(t){return{integerValue:""+t}}function Ro(t,e){return Ai(e)?Co(e):xo(t,e)}var Po=function(){this._=void 0};function Lo(t,e,n){return t instanceof Fo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Vo?qo(t,e):t instanceof Bo?Ko(t,e):function(t,e){var n=Uo(t,e),r=zo(n)+zo(t.A);return Fi(n)&&Fi(t.A)?Co(r):xo(t.R,r)}(t,e)}function Mo(t,e,n){return t instanceof Vo?qo(t,e):t instanceof Bo?Ko(t,e):n}function Uo(t,e){return t instanceof Go?Fi(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Fo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(P.c)(e,t),e}(Po),Vo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(P.c)(e,t),e}(Po);function qo(t,e){for(var n=Qo(e),r=function(t){n.some(function(e){return xi(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Bo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(P.c)(e,t),e}(Po);function Ko(t,e){for(var n=Qo(e),r=function(t){n=n.filter(function(e){return!xi(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Go=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(P.c)(e,t),e}(Po);function zo(t){return Ii(t.integerValue||t.doubleValue)}function Qo(t){return Vi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Ho=function(t,e){this.field=t,this.transform=e},Wo=function(t,e){this.version=t,this.transformResults=e},Yo=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Xo(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var $o=function(){};function Jo(t,e,n){t instanceof rs?function(t,e,n){var r=t.value.clone(),i=ss(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof is?function(t,e,n){if(Xo(t.precondition,e)){var r=ss(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(os(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Zo(t,e,n){t instanceof rs?function(t,e,n){if(Xo(t.precondition,e)){var r=t.value.clone(),i=as(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(ns(e),r).setHasLocalMutations()}}(t,e,n):t instanceof is?function(t,e,n){if(Xo(t.precondition,e)){var r=as(t.fieldTransforms,n,e),i=e.data;i.setAll(os(t)),i.setAll(r),e.convertToFoundDocument(ns(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){Xo(t.precondition,e)&&e.convertToNoDocument(hi.min())}(t,e)}function ts(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=Uo(o.transform,s||null);null!=a&&(null==n&&(n=zi.empty()),n.set(o.field,a))}return n||null}function es(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&ai(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Vo&&e instanceof Vo||t instanceof Bo&&e instanceof Bo?ai(t.elements,e.elements,xi):t instanceof Go&&e instanceof Go?xi(t.A,e.A):t instanceof Fo&&e instanceof Fo}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function ns(t){return t.isFoundDocument()?t.version:hi.min()}var rs=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(P.c)(e,t),e}($o),is=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(P.c)(e,t),e}($o);function os(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function ss(t,e,n){var r=new Map;ni(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,Mo(s,a,n[i]))}return r}function as(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,Lo(a,u,e))}return r}var us,cs,hs=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(P.c)(e,t),e}($o),ls=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(P.c)(e,t),e}($o),fs=function(t){this.count=t};function ds(t){switch(t){case Hr.OK:return ei();case Hr.CANCELLED:case Hr.UNKNOWN:case Hr.DEADLINE_EXCEEDED:case Hr.RESOURCE_EXHAUSTED:case Hr.INTERNAL:case Hr.UNAVAILABLE:case Hr.UNAUTHENTICATED:return!1;case Hr.INVALID_ARGUMENT:case Hr.NOT_FOUND:case Hr.ALREADY_EXISTS:case Hr.PERMISSION_DENIED:case Hr.FAILED_PRECONDITION:case Hr.ABORTED:case Hr.OUT_OF_RANGE:case Hr.UNIMPLEMENTED:case Hr.DATA_LOSS:return!0;default:return ei()}}function ps(t){if(void 0===t)return Jr("GRPC error has no .code"),Hr.UNKNOWN;switch(t){case us.OK:return Hr.OK;case us.CANCELLED:return Hr.CANCELLED;case us.UNKNOWN:return Hr.UNKNOWN;case us.DEADLINE_EXCEEDED:return Hr.DEADLINE_EXCEEDED;case us.RESOURCE_EXHAUSTED:return Hr.RESOURCE_EXHAUSTED;case us.INTERNAL:return Hr.INTERNAL;case us.UNAVAILABLE:return Hr.UNAVAILABLE;case us.UNAUTHENTICATED:return Hr.UNAUTHENTICATED;case us.INVALID_ARGUMENT:return Hr.INVALID_ARGUMENT;case us.NOT_FOUND:return Hr.NOT_FOUND;case us.ALREADY_EXISTS:return Hr.ALREADY_EXISTS;case us.PERMISSION_DENIED:return Hr.PERMISSION_DENIED;case us.FAILED_PRECONDITION:return Hr.FAILED_PRECONDITION;case us.ABORTED:return Hr.ABORTED;case us.OUT_OF_RANGE:return Hr.OUT_OF_RANGE;case us.UNIMPLEMENTED:return Hr.UNIMPLEMENTED;case us.DATA_LOSS:return Hr.DATA_LOSS;default:return ei()}}(cs=us||(us={}))[cs.OK=0]="OK",cs[cs.CANCELLED=1]="CANCELLED",cs[cs.UNKNOWN=2]="UNKNOWN",cs[cs.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",cs[cs.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",cs[cs.NOT_FOUND=5]="NOT_FOUND",cs[cs.ALREADY_EXISTS=6]="ALREADY_EXISTS",cs[cs.PERMISSION_DENIED=7]="PERMISSION_DENIED",cs[cs.UNAUTHENTICATED=16]="UNAUTHENTICATED",cs[cs.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",cs[cs.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",cs[cs.ABORTED=10]="ABORTED",cs[cs.OUT_OF_RANGE=11]="OUT_OF_RANGE",cs[cs.UNIMPLEMENTED=12]="UNIMPLEMENTED",cs[cs.INTERNAL=13]="INTERNAL",cs[cs.UNAVAILABLE=14]="UNAVAILABLE",cs[cs.DATA_LOSS=15]="DATA_LOSS";var gs=function(){function t(t,e){this.comparator=t,this.root=e||ms.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,ms.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ms.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new ys(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new ys(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new ys(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new ys(this.root,t,this.comparator,!0)},t}(),ys=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),ms=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw ei();if(this.right.isRed())throw ei();var t=this.left.check();if(t!==this.right.check())throw ei();return t+(this.isRed()?0:1)},t}();ms.EMPTY=null,ms.RED=!0,ms.BLACK=!1,ms.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw ei()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw ei()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw ei()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw ei()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw ei()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new ms(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var vs=function(){function t(t){this.comparator=t,this.data=new gs(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new bs(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new bs(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),bs=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),ws=new gs(Ni.comparator);function Ts(){return ws}var Is=new gs(Ni.comparator);function Es(){return Is}var _s=new gs(Ni.comparator);function Os(){return _s}var Ss=new vs(Ni.comparator);function ks(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Ss,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Ds=new vs(si);function As(){return Ds}var Ns=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,js.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(hi.min(),r,As(),Ts(),ks())},t}(),js=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(bi.EMPTY_BYTE_STRING,n,ks(),ks(),ks())},t}(),xs=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},Cs=function(t,e){this.targetId=t,this.V=e},Rs=function(t,e,n,r){void 0===n&&(n=bi.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Ps=function(){function t(){this.S=0,this.D=Us(),this.C=bi.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=ks(),e=ks(),n=ks();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:ei()}}),new js(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=Us()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),Ls=function(){function t(t){this.W=t,this.G=new Map,this.H=Ts(),this.J=Ms(),this.Y=new vs(si)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:ei()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(Ji(i))if(0===n){var o=new Ni(i.path);this.tt(e,o,Hi.newNoDocument(o,hi.min()))}else ni(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&Ji(o.target)){var s=new Ni(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,Hi.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}});var r=ks();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new Ns(t,n,this.Y,this.H,r);return this.H=Ts(),this.J=Ms(),this.Y=new vs(si),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new Ps,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new vs(si),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||$r("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new Ps),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function Ms(){return new gs(Ni.comparator)}function Us(){return new gs(Ni.comparator)}var Fs={asc:"ASCENDING",desc:"DESCENDING"},Vs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},qs=function(t,e){this.databaseId=t,this.I=e};function Bs(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ks(t,e){return t.I?e.toBase64():e.toUint8Array()}function Gs(t,e){return Bs(t,e.toTimestamp())}function zs(t){return ni(!!t),hi.fromTimestamp(function(t){var e=Ti(t);return new ci(e.seconds,e.nanos)}(t))}function Qs(t,e){return function(t){return new gi(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Hs(t){var e=gi.fromString(t);return ni(ma(e)),e}function Ws(t,e){return Qs(t.databaseId,e.path)}function Ys(t,e){var n=Hs(e);if(n.get(1)!==t.databaseId.projectId)throw new Wr(Hr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Wr(Hr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Ni(Zs(n))}function Xs(t,e){return Qs(t.databaseId,e)}function $s(t){var e=Hs(t);return 4===e.length?gi.emptyPath():Zs(e)}function Js(t){return new gi(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Zs(t){return ni(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function ta(t,e,n){return{name:Ws(t,e),fields:n.value.mapValue.fields}}function ea(t,e,n){var r=Ys(t,e.name),i=zs(e.updateTime),o=new zi({mapValue:{fields:e.fields}}),s=Hi.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function na(t,e){var n;if(e instanceof rs)n={update:ta(t,e.key,e.value)};else if(e instanceof hs)n={delete:Ws(t,e.key)};else if(e instanceof is)n={update:ta(t,e.key,e.data),updateMask:ya(e.fieldMask)};else{if(!(e instanceof ls))return ei();n={verify:Ws(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof Fo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Vo)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Bo)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Go)return{fieldPath:e.field.canonicalString(),increment:n.A};throw ei()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Gs(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:ei()}(t,e.precondition)),n}function ra(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Yo.updateTime(zs(t.updateTime)):void 0!==t.exists?Yo.exists(t.exists):Yo.none()}(e.currentDocument):Yo.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;"setToServerValue"in e?(ni("REQUEST_TIME"===e.setToServerValue),n=new Fo):"appendMissingElements"in e?n=new Vo(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new Bo(e.removeAllFromArray.values||[]):"increment"in e?n=new Go(t,e.increment):ei();var r=mi.fromServerFormat(e.fieldPath);return new Ho(r,n)}(t,e)}):[];if(e.update){var i=Ys(t,e.update.name),o=new zi({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new vi((t.fieldPaths||[]).map(function(t){return mi.fromServerFormat(t)}))}(e.updateMask);return new is(i,o,s,n,r)}return new rs(i,o,n,r)}if(e.delete){var a=Ys(t,e.delete);return new hs(a,n)}if(e.verify){var u=Ys(t,e.verify);return new ls(u,n)}return ei()}function ia(t,e){return{documents:[Xs(t,e.path)]}}function oa(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Xs(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Xs(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(Bi(t.value))return{unaryFilter:{field:fa(t.field),op:"IS_NAN"}};if(qi(t.value))return{unaryFilter:{field:fa(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Bi(t.value))return{unaryFilter:{field:fa(t.field),op:"IS_NOT_NAN"}};if(qi(t.value))return{unaryFilter:{field:fa(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:fa(t.field),op:la(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:fa(t.field),direction:ha(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||ki(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=ua(e.startAt)),e.endAt&&(n.structuredQuery.endAt=ua(e.endAt)),n}function sa(t){var e=$s(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){ni(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=aa(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(t){return function(t){return new ho(da(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var u=null;n.limit&&(u=function(t){var e;return ki(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=ca(n.startAt));var h=null;return n.endAt&&(h=ca(n.endAt)),yo(e,i,a,s,u,"F",c,h)}function aa(t){return t?void 0!==t.unaryFilter?[ga(t)]:void 0!==t.fieldFilter?[pa(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return aa(t)}).reduce(function(t,e){return t.concat(e)}):ei():[]}function ua(t){return{before:t.before,values:t.position}}function ca(t){return new uo(t.values||[],!!t.before)}function ha(t){return Fs[t]}function la(t){return Vs[t]}function fa(t){return{fieldPath:t.canonicalString()}}function da(t){return mi.fromServerFormat(t.fieldPath)}function pa(t){return Zi.create(da(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return ei()}}(t.fieldFilter.op),t.fieldFilter.value)}function ga(t){switch(t.unaryFilter.op){case"IS_NAN":var e=da(t.unaryFilter.field);return Zi.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=da(t.unaryFilter.field);return Zi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=da(t.unaryFilter.field);return Zi.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=da(t.unaryFilter.field);return Zi.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return ei()}}function ya(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function ma(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function va(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=wa(e)),e=ba(t.get(n),e);return wa(e)}function ba(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function wa(t){return t+"\x01\x01"}function Ta(t){var e=t.length;if(ni(e>=2),2===e)return ni("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),gi.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&ei(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:ei()}o=s+2}return new gi(r)}var Ia=function(t,e){this.seconds=t,this.nanoseconds=e},Ea=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Ea.store="owner",Ea.key="owner";var _a=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};_a.store="mutationQueues",_a.keyPath="userId";var Oa=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Oa.store="mutations",Oa.keyPath="batchId",Oa.userMutationsIndex="userMutationsIndex",Oa.userMutationsKeyPath=["userId","batchId"];var Sa=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,va(e)]},t.key=function(t,e,n){return[t,va(e),n]},t}();Sa.store="documentMutations",Sa.PLACEHOLDER=new Sa;var ka=function(t,e){this.path=t,this.readTime=e},Da=function(t,e){this.path=t,this.version=e},Aa=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Aa.store="remoteDocuments",Aa.readTimeIndex="readTimeIndex",Aa.readTimeIndexPath="readTime",Aa.collectionReadTimeIndex="collectionReadTimeIndex",Aa.collectionReadTimeIndexPath=["parentPath","readTime"];var Na=function(t){this.byteSize=t};Na.store="remoteDocumentGlobal",Na.key="remoteDocumentGlobalKey";var ja=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};ja.store="targets",ja.keyPath="targetId",ja.queryTargetsIndexName="queryTargetsIndex",ja.queryTargetsKeyPath=["canonicalId","targetId"];var xa=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};xa.store="targetDocuments",xa.keyPath=["targetId","path"],xa.documentTargetsIndex="documentTargetsIndex",xa.documentTargetsKeyPath=["path","targetId"];var Ca=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Ca.key="targetGlobalKey",Ca.store="targetGlobal";var Ra=function(t,e){this.collectionId=t,this.parent=e};Ra.store="collectionParents",Ra.keyPath=["collectionId","parent"];var Pa=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Pa.store="clientMetadata",Pa.keyPath="clientId";var La=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};La.store="bundles",La.keyPath="bundleId";var Ma=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Ma.store="namedQueries",Ma.keyPath="name";var Ua=Object(P.f)(Object(P.f)([],Object(P.f)(Object(P.f)([],Object(P.f)(Object(P.f)([],Object(P.f)(Object(P.f)([],[_a.store,Oa.store,Sa.store,Aa.store,ja.store,Ea.store,Ca.store,xa.store]),[Pa.store])),[Na.store])),[Ra.store])),[La.store,Ma.store]),Fa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Va=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),qa=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},Ba=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&ei(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),Ka=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new qa,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new Qa(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=$a(e.target.error);n.ft.reject(new Qa(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new Qa(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||($r("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Wa(e)},t}(),Ga=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object(L.i)())&&Jr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return $r("SimpleDb","Removing database:",t),Ya(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object(L.i)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Object(P.b)(this,void 0,void 0,function(){var e,n=this;return Object(P.d)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:($r("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new Qa(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new Wr(Hr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new Qa(t,n))},i.onupgradeneeded=function(t){$r("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next(function(){$r("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(P.b)(this,void 0,void 0,function(){var i,o,s,a,u;return Object(P.d)(this,function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return Object(P.d)(this,function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=Ka.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch(function(t){return e.abort(t),Ba.reject(t)}).toPromise(),u={},s.catch(function(){}),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return $r("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}})},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),za=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return Ya(this.Pt.delete())},t}(),Qa=function(t){function e(e,n){var r=this;return(r=t.call(this,Hr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(P.c)(e,t),e}(Wr);function Ha(t){return"IndexedDbTransactionError"===t.name}var Wa=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?($r("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):($r("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Ya(n)},t.prototype.add=function(t){return $r("SimpleDb","ADD",this.store.name,t,t),Ya(this.store.add(t))},t.prototype.get=function(t){var e=this;return Ya(this.store.get(t)).next(function(n){return void 0===n&&(n=null),$r("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return $r("SimpleDb","DELETE",this.store.name,t),Ya(this.store.delete(t))},t.prototype.count=function(){return $r("SimpleDb","COUNT",this.store.name),Ya(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.Ft=function(t,e){$r("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new Ba(function(n,r){e.onerror=function(t){var e=$a(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new Ba(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new za(i),s=e(i.primaryKey,i.value,o);if(s instanceof Ba){var a=s.catch(function(t){return o.done(),Ba.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return Ba.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Ya(t){return new Ba(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=$a(t.target.error);n(e)}})}var Xa=!1;function $a(t){var e=Ga._t(Object(L.i)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new Wr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Xa||(Xa=!0,setTimeout(function(){throw r},0)),r}}return t}var Ja=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(P.c)(e,t),e}(Va);function Za(t,e){var n=ri(t);return Ga.It(n.Mt,e)}var tu=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&Jo(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&Zo(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&Zo(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(hi.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},ks())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&ai(this.mutations,t.mutations,function(t,e){return es(t,e)})&&ai(this.baseMutations,t.baseMutations,function(t,e){return es(t,e)})},t}(),eu=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){ni(e.mutations.length===r.length);for(var i=Os(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),nu=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=hi.min()),void 0===o&&(o=hi.min()),void 0===s&&(s=bi.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),ru=function(t){this.Lt=t};function iu(t,e){if(e.document)return ea(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Ni.fromSegments(e.noDocument.path),r=cu(e.noDocument.readTime),i=Hi.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=Ni.fromSegments(e.unknownDocument.path);return r=cu(e.unknownDocument.version),Hi.newUnknownDocument(o,r)}return ei()}function ou(t,e,n){var r=su(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:Ws(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Bs(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new Aa(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=uu(e.version);return s=e.hasCommittedMutations,new Aa(null,new ka(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=uu(e.version);return new Aa(new Da(c,h),null,null,!0,r,i)}return ei()}function su(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function au(t){var e=new ci(t[0],t[1]);return hi.fromTimestamp(e)}function uu(t){var e=t.toTimestamp();return new Ia(e.seconds,e.nanoseconds)}function cu(t){var e=new ci(t.seconds,t.nanoseconds);return hi.fromTimestamp(e)}function hu(t,e){for(var n=(e.baseMutations||[]).map(function(e){return ra(t.Lt,e)}),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map(function(e){return ra(t.Lt,e)}),o=ci.fromMillis(e.localWriteTimeMs);return new tu(e.batchId,o,n,i)}function lu(t){var e,n,r=cu(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?cu(t.lastLimboFreeSnapshotVersion):hi.min();return void 0!==t.query.documents?(ni(1===(n=t.query).documents.length),e=_o(mo($s(n.documents[0])))):e=function(t){return _o(sa(t))}(t.query),new nu(e,t.targetId,0,t.lastListenSequenceNumber,r,i,bi.fromBase64String(t.resumeToken))}function fu(t,e){var n,r=uu(e.snapshotVersion),i=uu(e.lastLimboFreeSnapshotVersion);n=Ji(e.target)?ia(t.Lt,e.target):oa(t.Lt,e.target);var o=e.resumeToken.toBase64();return new ja(e.targetId,Xi(e.target),r,o,e.sequenceNumber,i,n)}function du(t){var e=sa({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Oo(e,e.limit,"L"):e}var pu=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return gu(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:cu(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return gu(t).put({bundleId:(n=e).id,createTime:uu(zs(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return yu(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:du(e.bundledQuery),readTime:cu(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return yu(t).put(function(t){return{name:t.name,readTime:uu(zs(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function gu(t){return Za(t,La.store)}function yu(t){return Za(t,Ma.store)}var mu=function(){function t(){this.Bt=new vu}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),Ba.resolve()},t.prototype.getCollectionParents=function(t,e){return Ba.resolve(this.Bt.getEntries(e))},t}(),vu=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new vs(gi.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new vs(gi.comparator)).toArray()},t}(),bu=function(){function t(){this.qt=new vu}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:va(i)};return wu(t).put(o)}return Ba.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[ui(e),""],!1,!0);return wu(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Ta(o.parent))}return n})},t}();function wu(t){return Za(t,Ra.store)}var Tu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Iu=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function Eu(t,e,n){var r=t.store(Oa.store),i=t.store(Sa.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){ni(1===a)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=Sa.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return Ba.waitFor(o).next(function(){return c})}function _u(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw ei();e=t.noDocument}return JSON.stringify(e).length}Iu.DEFAULT_COLLECTION_PERCENTILE=10,Iu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Iu.DEFAULT=new Iu(41943040,Iu.DEFAULT_COLLECTION_PERCENTILE,Iu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Iu.DISABLED=new Iu(-1,0,0);var Ou=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return ni(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ku(t).$t({index:Oa.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Du(t),s=ku(t);return s.add({}).next(function(a){ni("number"==typeof a);for(var u=new tu(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return na(t.Lt,e)}),i=n.mutations.map(function(e){return na(t.Lt,e)});return new Oa(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new vs(function(t,e){return si(t.canonicalString(),e.canonicalString())}),f=0,d=r;f<d.length;f++){var p=d[f],g=Sa.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(g,Sa.PLACEHOLDER))}return l.forEach(function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Kt[a]=u.keys()}),Ba.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return ku(t).get(e).next(function(t){return t?(ni(t.userId===n.userId),hu(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?Ba.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return ku(t).$t({index:Oa.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(ni(e.batchId>=r),o=hu(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return ku(t).$t({index:Oa.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ku(t).Nt(Oa.userMutationsIndex,n).next(function(t){return t.map(function(t){return hu(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Sa.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Du(t).$t({range:i},function(r,i,s){var a=r[0],u=r[2],c=Ta(r[1]);if(a===n.userId&&e.path.isEqual(c))return ku(t).get(u).next(function(t){if(!t)throw ei();ni(t.userId===n.userId),o.push(hu(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new vs(si),i=[];return e.forEach(function(e){var o=Sa.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=Du(t).$t({range:s},function(t,i,o){var s=t[0],a=t[2],u=Ta(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()});i.push(a)}),Ba.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=Sa.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new vs(si);return Du(t).$t({range:s},function(t,e,o){var s=t[0],u=t[2],c=Ta(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(ku(t).get(e).next(function(t){if(null===t)throw ei();ni(t.userId===n.userId),r.push(hu(n.R,t))}))}),Ba.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return Eu(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),Ba.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return Ba.resolve();var r=IDBKeyRange.lowerBound(Sa.prefixForUser(e.userId)),i=[];return Du(t).$t({range:r},function(t,n,r){if(t[0]===e.userId){var o=Ta(t[1]);i.push(o)}else r.done()}).next(function(){ni(0===i.length)})})},t.prototype.containsKey=function(t,e){return Su(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return Au(t).get(this.userId).next(function(t){return t||new _a(e.userId,-1,"")})},t}();function Su(t,e,n){var r=Sa.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Du(t).$t({range:o,kt:!0},function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()}).next(function(){return s})}function ku(t){return Za(t,Oa.store)}function Du(t){return Za(t,Sa.store)}function Au(t){return Za(t,_a.store)}var Nu=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),ju=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new Nu(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return hi.fromTimestamp(new ci(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return xu(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return ni(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return xu(t).$t(function(s,a){var u=lu(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return Ba.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return xu(t).$t(function(t,n){var r=lu(n);e(r)})},t.prototype.Xt=function(t){return Cu(t).get(Ca.key).next(function(t){return ni(null!==t),t})},t.prototype.Zt=function(t,e){return Cu(t).put(Ca.key,e)},t.prototype.te=function(t,e){return xu(t).put(fu(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=Xi(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return xu(t).$t({range:r,index:ja.queryTargetsIndexName},function(t,n,r){var o=lu(n);$i(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Ru(t);return e.forEach(function(e){var s=va(e.path);i.push(o.put(new xa(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),Ba.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Ru(t);return Ba.forEach(e,function(e){var o=va(e.path);return Ba.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Ru(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Ru(t),i=ks();return r.$t({range:n,kt:!0},function(t,e,n){var r=Ta(t[1]),o=new Ni(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=va(e.path),r=IDBKeyRange.bound([n],[ui(n)],!1,!0),i=0;return Ru(t).$t({index:xa.documentTargetsIndex,kt:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return xu(t).get(e).next(function(t){return t?lu(t):null})},t}();function xu(t){return Za(t,ja.store)}function Cu(t){return Za(t,Ca.store)}function Ru(t){return Za(t,xa.store)}function Pu(t){return Object(P.b)(this,void 0,void 0,function(){return Object(P.d)(this,function(e){if(t.code!==Hr.FAILED_PRECONDITION||t.message!==Fa)throw t;return $r("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Lu(t,e){var n=t[1],r=e[1],i=si(t[0],e[0]);return 0===i?si(n,r):i}var Mu=function(){function t(t){this.ne=t,this.buffer=new vs(Lu),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Lu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Uu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;$r("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return Object(P.b)(e,void 0,void 0,function(){var e;return Object(P.d)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return Ha(e=n.sent())?($r("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Pu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}})})})},t}(),Fu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Ba.resolve(Qr.o);var r=new Mu(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?($r("LruGarbageCollector","Garbage collection skipped; disabled"),Ba.resolve(Tu)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?($r("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Tu):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?($r("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){return u=Date.now(),Xr()<=M.a.DEBUG&&$r("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),Ba.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),Vu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new Fu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return qu(t,n)},t.prototype.removeReference=function(t,e,n){return qu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return qu(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return Au(t).Ot(function(r){return Su(t,r,e).next(function(t){return t&&(n=!0),Ba.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var u=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),Ru(t).delete([0,va(s.path)])})});i.push(u)}}).next(function(){return Ba.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return qu(t,e)},t.prototype.we=function(t,e){var n,r=Ru(t),i=Qr.o;return r.$t({index:xa.documentTargetsIndex},function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==Qr.o&&e(new Ni(Ta(n)),i),i=s,n=o):i=Qr.o}).next(function(){i!==Qr.o&&e(new Ni(Ta(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function qu(t,e){return Ru(t).put(function(t,e){return new xa(0,va(t.path),e)}(e,t.currentSequenceNumber))}var Bu=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){fi(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return di(this.inner)},t}(),Ku=function(){function t(){this.changes=new Bu(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:hi.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:Hi.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Ba.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),Gu=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return Hu(t).put(Wu(e),n)},t.prototype.removeEntry=function(t,e){var n=Hu(t),r=Wu(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return Hu(t).get(Wu(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return Hu(t).get(Wu(e)).next(function(t){return{document:n.ye(e,t),size:_u(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=Ts();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=Ts(),i=new gs(Ni.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,_u(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return Ba.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Hu(t).$t({range:r},function(t,e,r){for(var s=Ni.fromSegments(t);o&&Ni.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Ts(),o=e.path.length+1,s={};if(n.isEqual(hi.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=su(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=Aa.collectionReadTimeIndex}return Hu(t).$t(s,function(t,n,s){if(t.length===o){var a=iu(r.R,n);e.path.isPrefixOf(a.key.path)?Ao(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new zu(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return Qu(t).get(Na.key).next(function(t){return ni(!!t),t})},t.prototype.me=function(t,e){return Qu(t).put(Na.key,e)},t.prototype.ye=function(t,e){if(e){var n=iu(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(hi.min()))return n}return Hi.newInvalidDocument(t)},t}(),zu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new Bu(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return Object(P.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new vs(function(t,e){return si(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=ou(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=_u(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=ou(e.Ie.R,Hi.newNoDocument(o,hi.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),Ba.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(Ku);function Qu(t){return Za(t,Na.store)}function Hu(t){return Za(t,Aa.store)}function Wu(t){return t.path.toArray()}var Yu=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;ni(n<r&&n>=0&&r<=11);var o=new Ka("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Ea.store)}(t),function(t){t.createObjectStore(_a.store,{keyPath:_a.keyPath}),t.createObjectStore(Oa.store,{keyPath:Oa.keyPath,autoIncrement:!0}).createIndex(Oa.userMutationsIndex,Oa.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Sa.store)}(t),Xu(t),function(t){t.createObjectStore(Aa.store)}(t));var s=Ba.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(xa.store),t.deleteObjectStore(ja.store),t.deleteObjectStore(Ca.store)}(t),Xu(t)),s=s.next(function(){return function(t){var e=t.store(Ca.store),n=new Ca(0,0,hi.min().toTimestamp(),0);return e.put(Ca.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(Oa.store).Nt().next(function(n){t.deleteObjectStore(Oa.store),t.createObjectStore(Oa.store,{keyPath:Oa.keyPath,autoIncrement:!0}).createIndex(Oa.userMutationsIndex,Oa.userMutationsKeyPath,{unique:!0});var r=e.store(Oa.store),i=n.map(function(t){return r.put(t)});return Ba.waitFor(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(Pa.store,{keyPath:Pa.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(Na.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Aa.store);e.createIndex(Aa.readTimeIndex,Aa.readTimeIndexPath,{unique:!1}),e.createIndex(Aa.collectionReadTimeIndex,Aa.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(t){t.createObjectStore(La.store,{keyPath:La.keyPath})}(t),function(t){t.createObjectStore(Ma.store,{keyPath:Ma.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(Aa.store).$t(function(t,n){e+=_u(n)}).next(function(){var n=new Na(e);return t.store(Na.store).put(Na.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(_a.store),r=t.store(Oa.store);return n.Nt().next(function(n){return Ba.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(Oa.userMutationsIndex,i).next(function(r){return Ba.forEach(r,function(r){ni(r.userId===n.userId);var i=hu(e.R,r);return Eu(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(xa.store),n=t.store(Aa.store);return t.store(Ca.store).get(Ca.key).next(function(t){var r=[];return n.$t(function(n,i){var o=new gi(n),s=function(t){return[0,va(t)]}(o);r.push(e.get(s).next(function(n){return n?Ba.resolve():function(n){return e.put(new xa(0,va(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return Ba.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(Ra.store,{keyPath:Ra.keyPath});var n=e.store(Ra.store),r=new vu,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:va(i)})}};return e.store(Aa.store).$t({kt:!0},function(t,e){var n=new gi(t);return i(n.popLast())}).next(function(){return e.store(Sa.store).$t({kt:!0},function(t,e){var n=Ta(t[1]);return i(n.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(ja.store);return n.$t(function(t,r){var i=lu(r),o=fu(e.R,i);return n.put(o)})},t}();function Xu(t){t.createObjectStore(xa.store,{keyPath:xa.keyPath}).createIndex(xa.documentTargetsIndex,xa.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(ja.store,{keyPath:ja.keyPath}).createIndex(ja.queryTargetsIndexName,ja.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Ca.store)}var $u="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Ju=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new Wr(Hr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Vu(this,i),this.Le=n+"main",this.R=new ru(u),this.Be=new Ga(this.Le,11,new Yu(this.R)),this.qe=new ju(this.referenceDelegate,this.R),this.Ut=new bu,this.Ue=function(t,e){return new Gu(t,e)}(this.R,this.Ut),this.Ke=new pu,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===h&&Jr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Wr(Hr.FAILED_PRECONDITION,$u);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new Qr(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(P.b)(e,void 0,void 0,function(){return Object(P.d)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return Object(P.b)(e,void 0,void 0,function(){return Object(P.d)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return Object(P.b)(e,void 0,void 0,function(){return Object(P.d)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return tc(e).put(new Pa(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(Ha(e))return $r("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return $r("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return Zu(t).get(Ea.key).next(function(t){return Ba.resolve(e.tn(t))})},t.prototype.en=function(t){return tc(t).delete(this.clientId)},t.prototype.nn=function(){return Object(P.b)(this,void 0,void 0,function(){var t,e,n,r=this;return Object(P.d)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=Za(t,Pa.store);return e.Nt().next(function(t){var n=r.rn(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return Ba.forEach(i,function(t){return e.delete(t.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)this.Qe.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?Ba.resolve(!0):Zu(t).get(Ea.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new Wr(Hr.FAILED_PRECONDITION,$u);return!1}}return!(!e.networkEnabled||!e.inForeground)||tc(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&$r("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return Object(P.b)(this,void 0,void 0,function(){var t=this;return Object(P.d)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Ea.store,Pa.store],function(e){var n=new Ja(e,Qr.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return tc(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return Ou.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r,i=this;return $r("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",Ua,function(o){return r=new Ja(o,i.Ne?i.Ne.next():Qr.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw Jr("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new Wr(Hr.FAILED_PRECONDITION,Fa);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return Zu(t).get(Ea.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Wr(Hr.FAILED_PRECONDITION,$u)})},t.prototype.Ze=function(t){var e=new Ea(this.clientId,this.allowTabSynchronization,Date.now());return Zu(t).put(Ea.key,e)},t.yt=function(){return Ga.yt()},t.prototype.Xe=function(t){var e=this,n=Zu(t);return n.get(Ea.key).next(function(t){return e.tn(t)?($r("IndexedDbPersistence","Releasing primary lease."),n.delete(Ea.key)):Ba.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Jr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("pagehide",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return $r("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Jr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Jr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Zu(t){return Za(t,Ea.store)}function tc(t){return Za(t,Pa.store)}function ec(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var nc=function(t,e){this.progress=t,this.wn=e},rc=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return Ni.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):Io(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new Ni(e)).next(function(t){var e=Es();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=Es();return this.Ut.getCollectionParents(t,i).next(function(s){return Ba.forEach(s,function(s){var a=function(t,e){return new go(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return o.Rn(t,i=e,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=Hi.newInvalidDocument(c),r=r.insert(c,h)),Zo(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){Ao(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=ks(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof is&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),ic=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=ks(),i=ks(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),oc=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(hi.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(o){var s=i.Cn(e,o);return(vo(e)||bo(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(Xr()<=M.a.DEBUG&&$r("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Do(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return s.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new vs(No(t));return e.forEach(function(e,r){Ao(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return Xr()<=M.a.DEBUG&&$r("QueryEngine","Using full collection scan to execute query:",Do(e)),this.Sn.getDocumentsMatchingQuery(t,e,hi.min())},t}(),sc=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new gs(si),this.kn=new Bu(function(t){return Xi(t)},$i),this.$n=hi.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new rc(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.Fn)})},t}();function ac(t,e,n,r){return new sc(t,e,n,r)}function uc(t,e){return Object(P.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(P.d)(this,function(s){switch(s.label){case 0:return n=ri(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var o;return n._n.getAllMutationBatches(t).next(function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new rc(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],s=ks(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var g=0,y=p.mutations;g<y.length;g++)s=s.add(y[g].key)}return i.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function cc(t,e){var n=ri(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=Ba.resolve();return o.forEach(function(t){s=s.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);ni(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),s.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function hc(t){var e=ri(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function lc(t,e){var n=ri(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach(function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return ni(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}});var a=Ts();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),s.push(fc(t,o,e.documentUpdates,r,void 0).next(function(t){a=t})),!r.isEqual(hi.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});s.push(u)}return Ba.waitFor(s).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,a)}).next(function(){return a})}).then(function(t){return n.Fn=i,t})}function fc(t,e,n,r,i){var o=ks();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=Ts();return n.forEach(function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(hi.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):$r("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function dc(t,e){var n=ri(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function pc(t,e){var n=ri(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?Ba.resolve(r=i):n.qe.allocateTargetId(t).next(function(i){return r=new nu(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t})}function gc(t,e,n){return Object(P.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(P.d)(this,function(a){switch(a.label){case 0:r=ri(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(t){return r.persistence.referenceDelegate.removeTarget(t,i)})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!Ha(s=a.sent()))throw s;return $r("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}})})}function yc(t,e,n){var r=ri(t),i=hi.min(),o=ks();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=ri(t),i=r.kn.get(n);return void 0!==i?Ba.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,_o(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:hi.min(),n?o:ks())}).next(function(t){return{documents:t,Bn:o}})})}function mc(t,e){var n=ri(t),r=ri(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function vc(t){var e=ri(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=ri(t),i=Ts(),o=su(n),s=Hu(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:Aa.readTimeIndex,range:a},function(t,e){var n=iu(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:au(o)}})}(e.On,t,e.$n)}).then(function(t){var n=t.wn;return e.$n=t.readTime,n})}function bc(t){return Object(P.b)(this,void 0,void 0,function(){var e;return Object(P.d)(this,function(n){return[2,(e=ri(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=Hu(t),n=hi.min();return e.$t({index:Aa.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=au(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.$n=t})]})})}function wc(t,e,n,r){return Object(P.b)(this,void 0,void 0,function(){var i,o,s,a,u,c,h,l,f,d;return Object(P.d)(this,function(p){switch(p.label){case 0:for(i=ri(t),o=ks(),s=Ts(),a=Os(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Kn(h.metadata.readTime));return f=i.On.newChangeBuffer({trackRemovals:!0}),[4,pc(i,function(t){return _o(mo(gi.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return fc(t,f,s,hi.min(),a).next(function(e){return f.apply(t),e}).next(function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next(function(){return i.qe.addMatchingKeys(t,o,d.targetId)}).next(function(){return i.Mn.En(t,e)}).next(function(){return e})})})]}})})}function Tc(t,e,n){return void 0===n&&(n=ks()),Object(P.b)(this,void 0,void 0,function(){var r,i;return Object(P.d)(this,function(o){switch(o.label){case 0:return[4,pc(t,_o(du(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=ri(t)).persistence.runTransaction("Save named query","readwrite",function(t){var o=zs(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Ke.saveNamedQuery(t,e);var s=r.withResumeToken(bi.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next(function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return i.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return i.Ke.saveNamedQuery(t,e)})})]}})})}var Ic=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return Ba.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:zs(n.createTime)}),Ba.resolve()},t.prototype.getNamedQuery=function(t,e){return Ba.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:du(t.bundledQuery),readTime:zs(t.readTime)}}(e)),Ba.resolve()},t}(),Ec=function(){function t(){this.Wn=new vs(_c.Gn),this.zn=new vs(_c.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new _c(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new _c(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new Ni(new gi([])),r=new _c(n,t),i=new _c(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new Ni(new gi([])),n=new _c(e,t),r=new _c(e,t+1),i=ks();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new _c(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),_c=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return Ni.comparator(t.key,e.key)||si(t.ns,e.ns)},t.Hn=function(t,e){return si(t.ns,e.ns)||Ni.comparator(t.key,e.key)},t}(),Oc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new vs(_c.Gn)}return t.prototype.checkEmpty=function(t){return Ba.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new tu(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new _c(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return Ba.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return Ba.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return Ba.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return Ba.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return Ba.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new _c(e,0),i=new _c(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),Ba.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new vs(si);return e.forEach(function(t){var e=new _c(t,0),i=new _c(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),Ba.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Ni.isDocumentKey(i)||(i=i.child(""));var o=new _c(new Ni(i),0),s=new vs(si);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),Ba.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;ni(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return Ba.forEach(e.mutations,function(i){var o=new _c(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new _c(e,0),r=this.rs.firstAfterOrEqual(n);return Ba.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return Ba.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),Sc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new gs(Ni.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Ba.resolve(n?n.document.clone():Hi.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=Ts();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():Hi.newInvalidDocument(t))}),Ba.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Ts(),i=new Ni(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||Ao(e,u)&&(r=r.insert(u.key,u.clone()))}return Ba.resolve(r)},t.prototype.fs=function(t,e){return Ba.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new kc(this)},t.prototype.getSize=function(t){return Ba.resolve(this.size)},t}(),kc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(P.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),Ba.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(Ku),Dc=function(){function t(t){this.persistence=t,this.ds=new Bu(function(t){return Xi(t)},$i),this.lastRemoteSnapshotVersion=hi.min(),this.highestTargetId=0,this.ws=0,this._s=new Ec,this.targetCount=0,this.ys=Nu.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),Ba.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return Ba.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return Ba.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),Ba.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),Ba.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Nu(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,Ba.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),Ba.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,Ba.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),Ba.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return Ba.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return Ba.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),Ba.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),Ba.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),Ba.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return Ba.resolve(n)},t.prototype.containsKey=function(t,e){return Ba.resolve(this._s.containsKey(e))},t}(),Ac=function(){function t(t,e){var n=this;this.gs={},this.Ne=new Qr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Dc(this),this.Ut=new mu,this.Ue=function(t,e){return new Sc(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new ru(e),this.Ke=new Ic(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Oc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;$r("MemoryPersistence","Starting transaction:",t);var i=new Nc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return Ba.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),Nc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(P.c)(e,t),e}(Va),jc=function(){function t(t){this.persistence=t,this.As=new Ec,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw ei()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),Ba.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),Ba.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),Ba.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ba.forEach(this.vs,function(r){var i=Ni.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return Ba.or([function(){return Ba.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),xc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function Cc(t,e){return"firestore_clients_"+t+"_"+e}function Rc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function Pc(t,e){return"firestore_targets_"+t+"_"+e}xc.UNAUTHENTICATED=new xc(null),xc.GOOGLE_CREDENTIALS=new xc("google-credentials-uid"),xc.FIRST_PARTY=new xc("first-party-uid");var Lc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new Wr(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(Jr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Mc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Wr(i.error.code,i.error.message)),o?new t(e,i.state,r):(Jr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Uc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=As(),s=0;i&&s<r.activeTargetIds.length;++s)i=Ai(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Jr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Fc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Jr("SharedClientState","Failed to parse online state: "+e),null)},t}(),Vc=function(){function t(){this.activeTargetIds=As()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),qc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new gs(si),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=Cc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new Vc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(P.b)(this,void 0,void 0,function(){var t,e,n,r,i,o,s,a,u,c,h=this;return Object(P.d)(this,function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(Cc(this.persistenceKey,r)))&&(o=Uc.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Qs(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.$s;u<c.length;u++)this.Fs(c[u]);return this.$s=[],this.window.addEventListener("pagehide",function(){return h.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Pc(this.persistenceKey,t));if(n){var r=Mc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Pc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return $r("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){$r("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){$r("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if($r("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void Jr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return Object(P.b)(e,void 0,void 0,function(){var t,e,r,i,o,s;return Object(P.d)(this,function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=Qr.o;if(null!=t)try{var n=JSON.parse(t);ni("number"==typeof n),e=n}catch(t){Jr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Qr.o&&this.sequenceNumberHandler(s);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new Lc(this.currentUser,t,e,n),i=Rc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=Rc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=Pc(this.persistenceKey,t),i=new Mc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Uc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return Lc.Vs(new xc(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return Mc.Vs(r,e)},t.prototype.js=function(t){return Fc.Vs(t)},t.prototype.ii=function(t){return Object(P.b)(this,void 0,void 0,function(){return Object(P.d)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:($r("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.ks=r})},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=As();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),Bc=function(){function t(){this.li=new Vc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new Vc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),Kc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),Gc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){$r("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){$r("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),zc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Qc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),Hc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return Object(P.c)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise(function(i,o){var s=new zr;s.listenOnce(qr.COMPLETE,function(){try{switch(s.getLastErrorCode()){case Vr.NO_ERROR:var e=s.getResponseJson();$r("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Vr.TIMEOUT:$r("Connection",'RPC "'+t+'" timed out'),o(new Wr(Hr.DEADLINE_EXCEEDED,"Request time out"));break;case Vr.HTTP_ERROR:var n=s.getStatus();if($r("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(Hr).indexOf(e)>=0?e:Hr.UNKNOWN}(r.status);o(new Wr(a,r.message))}else o(new Wr(Hr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Wr(Hr.UNAVAILABLE,"Connection failed."));break;default:ei()}}finally{$r("Connection",'RPC "'+t+'" completed.')}});var a=JSON.stringify(r);s.send(e,"POST",a,n,15)})},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new Pr,i=De(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Kr({})),this.Fi(o.initMessageHeaders,e),Object(L.n)()||Object(L.p)()||Object(L.l)()||Object(L.m)()||Object(L.q)()||Object(L.k)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");$r("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new Qc({Ei:function(t){c?$r("Connection","Not sending because WebChannel is closed:",t):(u||($r("Connection","Opening WebChannel transport."),a.open(),u=!0),$r("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return l(a,Gr.EventType.OPEN,function(){c||$r("Connection","WebChannel transport opened.")}),l(a,Gr.EventType.CLOSE,function(){c||(c=!0,$r("Connection","WebChannel transport closed"),h.Vi())}),l(a,Gr.EventType.ERROR,function(t){c||(c=!0,Zr("Connection","WebChannel transport errored:",t),h.Vi(new Wr(Hr.UNAVAILABLE,"The operation could not be completed")))}),l(a,Gr.EventType.MESSAGE,function(t){var e;if(!c){var n=t.data[0];ni(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){$r("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=us[t];if(void 0!==e)return ps(e)}(i),s=r.message;void 0===o&&(o=Hr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new Wr(o,s)),a.close()}else $r("Connection","WebChannel received:",n),h.Si(n)}}),l(i,Br.STAT_EVENT,function(t){10===t.stat?$r("Connection","Detected buffering proxy"):11===t.stat&&$r("Connection","Detected no buffering proxy")}),setTimeout(function(){h.Pi()},0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);$r("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then(function(t){return $r("RestConnection","Received: ",t),t},function(e){throw Zr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.7.0",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+zc[t]},t}());function Wc(){return"undefined"!=typeof window?window:null}function Yc(){return"undefined"!=typeof document?document:null}function Xc(t){return new qs(t,!0)}var $c=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&$r("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),Jc=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new $c(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(P.b)(this,void 0,void 0,function(){return Object(P.d)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return Object(P.b)(this,void 0,void 0,function(){return Object(P.d)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(P.b)(this,void 0,void 0,function(){return Object(P.d)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Hr.RESOURCE_EXHAUSTED?(Jr(e.toString()),Jr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===Hr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new Wr(Hr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return Object(P.b)(t,void 0,void 0,function(){return Object(P.d)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return $r("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():($r("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Zc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Object(P.c)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:ei()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(ni(void 0===e||"string"==typeof e),bi.fromBase64String(e||"")):(ni(void 0===e||e instanceof Uint8Array),bi.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?Hr.UNKNOWN:ps(t.code);return new Wr(e,t.message||"")}(a);n=new Rs(r,i,o,s||null)}else if("documentChange"in e){i=Ys(t,(r=e.documentChange).document.name),o=zs(r.document.updateTime);var a=new zi({mapValue:{fields:r.document.fields}}),u=(s=Hi.newFoundDocument(i,o,a),r.targetIds||[]);n=new xs(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=Ys(t,(r=e.documentDelete).document),o=r.readTime?zs(r.readTime):hi.min(),a=Hi.newNoDocument(i,o),n=new xs([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=Ys(t,(r=e.documentRemove).document),n=new xs([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return ei();var c=e.filter;i=new fs(r=c.count||0),n=new Cs(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return hi.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?hi.min():e.readTime?zs(e.readTime):hi.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=Js(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=Ji(r)?{documents:ia(t,r)}:{query:oa(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Ks(t,e.resumeToken):e.snapshotVersion.compareTo(hi.min())>0&&(n.readTime=Bs(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return ei()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=Js(this.R),e.removeTarget=t,this.cr(e)},e}(Jc),th=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Object(P.c)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(ni(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(ni(void 0!==e),t.map(function(t){return function(t,e){var n=zs(t.updateTime?t.updateTime:e);return n.isEqual(hi.min())&&(n=zs(e)),new Wo(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=zs(t.commitTime);return this.listener.Tr(n,e)}return ni(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=Js(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return na(e.R,t)})};this.cr(n)},e}(Jc),eh=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(P.c)(e,t),e.prototype.br=function(){if(this.Rr)throw new Wr(Hr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Hr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Wr(Hr.UNKNOWN,t.toString())})},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.$i(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Hr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Wr(Hr.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),nh=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Jr(e),this.Vr=!1):$r("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),rh=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return Object(P.b)(o,void 0,void 0,function(){return Object(P.d)(this,function(t){switch(t.label){case 0:return fh(this)?($r("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(P.b)(this,void 0,void 0,function(){var e;return Object(P.d)(this,function(n){switch(n.label){case 0:return(e=ri(t)).Or.add(4),[4,oh(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,ih(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new nh(n,r)};function ih(t){return Object(P.b)(this,void 0,void 0,function(){var e,n;return Object(P.d)(this,function(r){switch(r.label){case 0:if(!fh(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function oh(t){return Object(P.b)(this,void 0,void 0,function(){var e,n;return Object(P.d)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function sh(t,e){var n=ri(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),lh(n)?hh(n):kh(n).er()&&uh(n,e))}function ah(t,e){var n=ri(t),r=kh(n);n.$r.delete(e),r.er()&&ch(n,e),0===n.$r.size&&(r.er()?r.ir():fh(n)&&n.Br.set("Unknown"))}function uh(t,e){t.qr.U(e.targetId),kh(t).mr(e)}function ch(t,e){t.qr.U(e),kh(t).yr(e)}function hh(t){t.qr=new Ls({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),kh(t).start(),t.Br.Sr()}function lh(t){return fh(t)&&!kh(t).tr()&&t.$r.size>0}function fh(t){return 0===ri(t).Or.size}function dh(t){t.qr=void 0}function ph(t){return Object(P.b)(this,void 0,void 0,function(){return Object(P.d)(this,function(e){return t.$r.forEach(function(e,n){uh(t,e)}),[2]})})}function gh(t,e){return Object(P.b)(this,void 0,void 0,function(){return Object(P.d)(this,function(n){return dh(t),lh(t)?(t.Br.Nr(e),hh(t)):t.Br.set("Unknown"),[2]})})}function yh(t,e,n){return Object(P.b)(this,void 0,void 0,function(){var r,i,o;return Object(P.d)(this,function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof Rs&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(P.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(P.d)(this,function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.$r.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.$r.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),$r("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,mh(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof xs?t.qr.X(e):e instanceof Cs?t.qr.rt(e):t.qr.et(e),n.isEqual(hi.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,hc(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(bi.EMPTY_BYTE_STRING,n.snapshotVersion)),ch(t,e);var r=new nu(n.target,e,1,n.sequenceNumber);uh(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return $r("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,mh(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function mh(t,e,n){return Object(P.b)(this,void 0,void 0,function(){var r=this;return Object(P.d)(this,function(i){switch(i.label){case 0:if(!Ha(e))throw e;return t.Or.add(1),[4,oh(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return hc(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return Object(P.b)(r,void 0,void 0,function(){return Object(P.d)(this,function(e){switch(e.label){case 0:return $r("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,ih(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function vh(t,e){return e().catch(function(n){return mh(t,n,e)})}function bh(t){return Object(P.b)(this,void 0,void 0,function(){var e,n,r,i,o;return Object(P.d)(this,function(s){switch(s.label){case 0:e=ri(t),n=Dh(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return fh(t)&&t.kr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,dc(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=Dh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,mh(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return wh(e)&&Th(e),[2]}})})}function wh(t){return fh(t)&&!Dh(t).tr()&&t.kr.length>0}function Th(t){Dh(t).start()}function Ih(t){return Object(P.b)(this,void 0,void 0,function(){return Object(P.d)(this,function(e){return Dh(t).Ar(),[2]})})}function Eh(t){return Object(P.b)(this,void 0,void 0,function(){var e,n,r;return Object(P.d)(this,function(i){for(e=Dh(t),n=0,r=t.kr;n<r.length;n++)e.Er(r[n].mutations);return[2]})})}function _h(t,e,n){return Object(P.b)(this,void 0,void 0,function(){var r,i;return Object(P.d)(this,function(o){switch(o.label){case 0:return r=t.kr.shift(),i=eu.from(r,e,n),[4,vh(t,function(){return t.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,bh(t)];case 2:return o.sent(),[2]}})})}function Oh(t,e){return Object(P.b)(this,void 0,void 0,function(){return Object(P.d)(this,function(n){switch(n.label){case 0:return e&&Dh(t).pr?[4,function(t,e){return Object(P.b)(this,void 0,void 0,function(){var n,r;return Object(P.d)(this,function(i){switch(i.label){case 0:return ds(r=e.code)&&r!==Hr.ABORTED?(n=t.kr.shift(),Dh(t).sr(),[4,vh(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,bh(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return wh(t)&&Th(t),[2]}})})}function Sh(t,e){return Object(P.b)(this,void 0,void 0,function(){var n;return Object(P.d)(this,function(r){switch(r.label){case 0:return n=ri(t),e?(n.Or.delete(2),[4,ih(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,oh(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function kh(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=ri(t);return r.br(),new Zc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:ph.bind(null,t),Ri:gh.bind(null,t),_r:yh.bind(null,t)}),t.Mr.push(function(n){return Object(P.b)(e,void 0,void 0,function(){return Object(P.d)(this,function(e){switch(e.label){case 0:return n?(t.Ur.sr(),lh(t)?hh(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),dh(t),e.label=3;case 3:return[2]}})})})),t.Ur}function Dh(t){var e=this;return t.Kr||(t.Kr=function(t,e,n){var r=ri(t);return r.br(),new th(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Ih.bind(null,t),Ri:Oh.bind(null,t),Ir:Eh.bind(null,t),Tr:_h.bind(null,t)}),t.Mr.push(function(n){return Object(P.b)(e,void 0,void 0,function(){return Object(P.d)(this,function(e){switch(e.label){case 0:return n?(t.Kr.sr(),[4,bh(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.kr.length>0&&($r("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}})})})),t.Kr}var Ah=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new qa,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Wr(Hr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function Nh(t,e){if(Jr("AsyncQueue",e+": "+t),Ha(t))return new Wr(Hr.UNAVAILABLE,e+": "+t);throw t}var jh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Ni.comparator(e.key,n.key)}:function(t,e){return Ni.comparator(t.key,e.key)},this.keyedMap=Es(),this.sortedSet=new gs(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),xh=function(){function t(){this.Qr=new gs(Ni.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):ei():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),Ch=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,jh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&So(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Rh=function(){this.Wr=void 0,this.listeners=[]},Ph=function(){this.queries=new Bu(function(t){return ko(t)},So),this.onlineState="Unknown",this.Gr=new Set};function Lh(t,e){return Object(P.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(P.d)(this,function(c){switch(c.label){case 0:if(n=ri(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new Rh),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=Nh(a,"Initialization of query '"+Do(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&Vh(n),[2]}})})}function Mh(t,e){return Object(P.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(P.d)(this,function(a){return n=ri(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function Uh(t,e){for(var n=ri(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&Vh(n)}function Fh(t,e,n){var r=ri(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function Vh(t){t.Gr.forEach(function(t){t.next()})}var qh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Ch(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=Ch.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),Bh=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),Kh=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return Ys(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?ea(this.R,t.document,!1):Hi.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return zs(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new Kh(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||ks()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(P.b)(this,void 0,void 0,function(){var t,e,n,r,i;return Object(P.d)(this,function(o){switch(o.label){case 0:return[4,wc(this.localStore,new Kh(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,Tc(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new nc(Object.assign({},this.progress),t))]}})})}}();var Gh=function(t){this.key=t},zh=function(t){this.key=t},Qh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=ks(),this.mutatedKeys=ks(),this.lo=No(t),this.fo=new jh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new xh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=vo(this.query)&&i.size===this.query.limit?i.last():null,c=bo(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=Ao(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),vo(this.query)||bo(this.query))for(;s.size>this.query.limit;){var h=vo(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ei()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new Ch(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new xh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=ks(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new zh(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new Gh(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=ks();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return Ch.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),Hh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Wh=function(t){this.key=t,this.bo=!1},Yh=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new Bu(function(t){return ko(t)},So),this.Vo=new Map,this.So=new Set,this.Do=new gs(Ni.comparator),this.Co=new Map,this.No=new Ec,this.xo={},this.Fo=new Map,this.ko=Nu.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function Xh(t,e){return Object(P.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(P.d)(this,function(a){switch(a.label){case 0:return n=Ol(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,pc(n.localStore,_o(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,$h(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&sh(n.remoteStore,o),a.label=4;case 4:return[2,r]}})})}function $h(t,e,n,r){return Object(P.b)(this,void 0,void 0,function(){var i,o,s,a,u,c;return Object(P.d)(this,function(h){switch(h.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return Object(P.b)(this,void 0,void 0,function(){var i,o,s;return Object(P.d)(this,function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,yc(t.localStore,e.query,!1).then(function(t){return e.view._o(t.documents,i)})]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(hl(t,e.targetId,s.To),s.snapshot)]}})})}(t,e,n,r)},[4,yc(t.localStore,e,!0)];case 1:return i=h.sent(),o=new Qh(e,i.Bn),s=o._o(i.documents),a=js.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),hl(t,n,u.To),c=new Hh(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}})})}function Jh(t,e){return Object(P.b)(this,void 0,void 0,function(){var n,r,i;return Object(P.d)(this,function(o){switch(o.label){case 0:return n=ri(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(t){return!So(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,gc(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),ah(n.remoteStore,r.targetId),ul(n,r.targetId)}).catch(Pu)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return ul(n,r.targetId),[4,gc(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function Zh(t,e,n){return Object(P.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(P.d)(this,function(a){switch(a.label){case 0:r=Sl(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=ri(t),i=ci.now(),o=e.reduce(function(t,e){return t.add(e.key)},ks());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=ts(c,n.get(c.key));null!=h&&s.push(new is(c.key,h,Qi(h.value.mapValue),Yo.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new gs(si)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,dl(r,i.changes)];case 3:return a.sent(),[4,bh(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=Nh(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function tl(t,e){return Object(P.b)(this,void 0,void 0,function(){var n,r;return Object(P.d)(this,function(i){switch(i.label){case 0:n=ri(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,lc(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(ni(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?ni(r.bo):t.removedDocuments.size>0&&(ni(r.bo),r.bo=!1))}),[4,dl(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,Pu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function el(t,e,n){var r=ri(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=ri(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&Vh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function nl(t,e,n){return Object(P.b)(this,void 0,void 0,function(){var r,i,o,s,a,u;return Object(P.d)(this,function(c){switch(c.label){case 0:return(r=ri(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new gs(Ni.comparator)).insert(o,Hi.newNoDocument(o,hi.min())),a=ks().add(o),u=new Ns(hi.min(),new Map,new vs(si),s,a),[4,tl(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),fl(r),[3,4];case 2:return[4,gc(r.localStore,e,!1).then(function(){return ul(r,e,n)}).catch(Pu)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function rl(t,e){return Object(P.b)(this,void 0,void 0,function(){var n,r,i;return Object(P.d)(this,function(o){switch(o.label){case 0:n=ri(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,cc(n.localStore,e)];case 2:return i=o.sent(),al(n,r,null),sl(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,dl(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,Pu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function il(t,e,n){return Object(P.b)(this,void 0,void 0,function(){var r,i;return Object(P.d)(this,function(o){switch(o.label){case 0:r=ri(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=ri(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return ni(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(r.localStore,e)];case 2:return i=o.sent(),al(r,e,n),sl(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,dl(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,Pu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function ol(t,e){return Object(P.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(P.d)(this,function(a){switch(a.label){case 0:fh((n=ri(t)).remoteStore)||$r("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=ri(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=a.sent(),s=Nh(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}})})}function sl(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function al(t,e,n){var r=ri(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function ul(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||cl(t,e)})}function cl(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(ah(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),fl(t))}function hl(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Gh?(t.No.addReference(o.key,e),ll(t,o)):o instanceof zh?($r("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||cl(t,o.key)):ei()}}function ll(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||($r("SyncEngine","New document in limbo: "+n),t.So.add(r),fl(t))}function fl(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Ni(gi.fromString(e)),r=t.ko.next();t.Co.set(r,new Wh(n)),t.Do=t.Do.insert(n,r),sh(t.remoteStore,new nu(_o(mo(n.path)),r,2,Qr.o))}}function dl(t,e,n){return Object(P.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(P.d)(this,function(a){switch(a.label){case 0:return r=ri(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,a){s.push(r.Oo(a,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=ic.Pn(a.targetId,t);o.push(e)}}))}),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return Object(P.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c;return Object(P.d)(this,function(h){switch(h.label){case 0:n=ri(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return Ba.forEach(e,function(e){return Ba.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return Ba.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return h.sent(),[3,4];case 3:if(!Ha(r=h.sent()))throw r;return $r("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.Fn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.Fn=n.Fn.insert(a,c));return[2]}})})}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function pl(t,e){return Object(P.b)(this,void 0,void 0,function(){var n,r;return Object(P.d)(this,function(i){switch(i.label){case 0:return(n=ri(t)).currentUser.isEqual(e)?[3,3]:($r("SyncEngine","User change. New user:",e.toKey()),[4,uc(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach(function(t){t.forEach(function(t){t.reject(new Wr(Hr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,dl(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function gl(t,e){var n=ri(t),r=n.Co.get(e);if(r&&r.bo)return ks().add(r.key);var i=ks(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function yl(t,e){return Object(P.b)(this,void 0,void 0,function(){var n,r,i;return Object(P.d)(this,function(o){switch(o.label){case 0:return[4,yc((n=ri(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&hl(n,e.targetId,i.To),i)]}})})}function ml(t){return Object(P.b)(this,void 0,void 0,function(){var e;return Object(P.d)(this,function(n){return[2,vc((e=ri(t)).localStore).then(function(t){return dl(e,t)})]})})}function vl(t,e,n,r){return Object(P.b)(this,void 0,void 0,function(){var i,o;return Object(P.d)(this,function(s){switch(s.label){case 0:return[4,function(t,e){var n=ri(t),r=ri(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):Ba.resolve(null)})})}((i=ri(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,bh(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(al(i,e,r||null),sl(i,e),function(t,e){ri(ri(t)._n).Gt(e)}(i.localStore,e)):ei(),s.label=4;case 4:return[4,dl(i,o)];case 5:return s.sent(),[3,7];case 6:$r("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}})})}function bl(t,e){return Object(P.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(P.d)(this,function(c){switch(c.label){case 0:return Ol(n=ri(t)),Sl(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,wl(n,r.toArray())]);case 1:return i=c.sent(),n.$o=!0,[4,Sh(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)sh(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then(function(){return ul(n,e),gc(n.localStore,e,!0)}),ah(n.remoteStore,e)}),[4,u]);case 4:return c.sent(),[4,wl(n,a)];case 5:return c.sent(),function(t){var e=ri(t);e.Co.forEach(function(t,n){ah(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new gs(Ni.comparator)}(n),n.$o=!1,[4,Sh(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})}function wl(t,e,n){return Object(P.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return Object(P.d)(this,function(g){switch(g.label){case 0:n=ri(t),r=[],i=[],o=0,s=e,g.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,pc(n.localStore,_o(c[0]))]:[3,7]):[3,13];case 2:u=g.sent(),h=0,l=c,g.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,yl(n,f)]):[3,6];case 4:(d=g.sent()).snapshot&&i.push(d.snapshot),g.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,mc(n.localStore,a)];case 8:return p=g.sent(),[4,pc(n.localStore,p)];case 9:return u=g.sent(),[4,$h(n,Tl(p),a,!1)];case 10:g.sent(),g.label=11;case 11:r.push(u),g.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function Tl(t){return yo(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Il(t){var e=ri(t);return ri(ri(e.localStore).persistence).fn()}function El(t,e,n,r){return Object(P.b)(this,void 0,void 0,function(){var i,o,s;return Object(P.d)(this,function(a){switch(a.label){case 0:return(i=ri(t)).$o?($r("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,vc(i.localStore)];case 3:return o=a.sent(),s=Ns.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,dl(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,gc(i.localStore,e,!0)];case 6:return a.sent(),ul(i,e,r),[3,8];case 7:ei(),a.label=8;case 8:return[2]}})})}function _l(t,e,n){return Object(P.b)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,l;return Object(P.d)(this,function(f){switch(f.label){case 0:if(!(r=Ol(t)).$o)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?($r("SyncEngine","Adding an already active target "+s),[3,5]):[4,mc(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,pc(r.localStore,a)];case 3:return u=f.sent(),[4,$h(r,Tl(a),u.targetId,!1)];case 4:f.sent(),sh(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return Object(P.d)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,gc(r.localStore,t,!1).then(function(){ah(r.remoteStore,t),ul(r,t)}).catch(Pu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function Ol(t){var e=ri(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=tl.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=gl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=nl.bind(null,e),e.vo._r=Uh.bind(null,e.eventManager),e.vo.Mo=Fh.bind(null,e.eventManager),e}function Sl(t){var e=ri(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=rl.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=il.bind(null,e),e}var kl=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(P.b)(this,void 0,void 0,function(){return Object(P.d)(this,function(e){switch(e.label){case 0:return this.R=Xc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return ac(this.persistence,new oc,t.initialUser,this.R)},t.prototype.qo=function(t){return new Ac(jc.bs,this.R)},t.prototype.Bo=function(t){return new Bc},t.prototype.terminate=function(){return Object(P.b)(this,void 0,void 0,function(){return Object(P.d)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),Dl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(P.c)(e,t),e.prototype.initialize=function(e){return Object(P.b)(this,void 0,void 0,function(){return Object(P.d)(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,bc(this.localStore)];case 2:return n.sent(),[4,this.Qo.initialize(this,e)];case 3:return n.sent(),[4,Sl(this.Qo.syncEngine)];case 4:return n.sent(),[4,bh(this.Qo.remoteStore)];case 5:return n.sent(),[2]}})})},e.prototype.Ko=function(t){return ac(this.persistence,new oc,t.initialUser,this.R)},e.prototype.Uo=function(t){return new Uu(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=ec(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Iu.withCacheSize(this.cacheSizeBytes):Iu.DEFAULT;return new Ju(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Wc(),Yc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new Bc},e}(kl),Al=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(P.c)(e,t),e.prototype.initialize=function(e){return Object(P.b)(this,void 0,void 0,function(){var n,r=this;return Object(P.d)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof qc?(this.sharedClientState.syncEngine={ui:vl.bind(null,n),ai:El.bind(null,n),hi:_l.bind(null,n),fn:Il.bind(null,n),ci:ml.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(t){return Object(P.b)(r,void 0,void 0,function(){return Object(P.d)(this,function(e){switch(e.label){case 0:return[4,bl(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},e.prototype.Bo=function(t){var e=Wc();if(!qc.yt(e))throw new Wr(Hr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=ec(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new qc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(Dl),Nl=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(P.b)(this,void 0,void 0,function(){var n=this;return Object(P.d)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return el(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=pl.bind(null,this.syncEngine),[4,Sh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new Ph},t.prototype.createDatastore=function(t){var e=Xc(t.databaseInfo.databaseId),n=new Hc(t.databaseInfo);return function(t,e,n){return new eh(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return el(s.syncEngine,t,0)},o=Gc.yt()?new Gc:new Kc,new rh(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new Yh(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(P.b)(this,void 0,void 0,function(){var e;return Object(P.d)(this,function(n){switch(n.label){case 0:return e=ri(t),$r("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,oh(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}(),jl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),xl=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new qa,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(P.b)(this,void 0,void 0,function(){return Object(P.d)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return Object(P.b)(this,void 0,void 0,function(){return Object(P.d)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return Object(P.b)(this,void 0,void 0,function(){var t,e,n,r;return Object(P.d)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new Bh(JSON.parse(r),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return Object(P.b)(this,void 0,void 0,function(){var t,e;return Object(P.d)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return Object(P.b)(this,void 0,void 0,function(){var e;return Object(P.d)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(P.b)(this,void 0,void 0,function(){var t,e;return Object(P.d)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(P.b)(this,void 0,void 0,function(){var e,n=this;return Object(P.d)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Wr(Hr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(P.b)(this,void 0,void 0,function(){var n,r,i,o,s,a;return Object(P.d)(this,function(u){switch(u.label){case 0:return n=ri(t),r=Js(n.R)+"/documents",i={documents:e.map(function(t){return Ws(n.R,t)})},[4,n.$i("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){ni(!!e.found);var n=Ys(t,e.found.name),r=zs(e.found.updateTime),i=new zi({mapValue:{fields:e.found.fields}});return Hi.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){ni(!!e.missing),ni(!!e.readTime);var n=Ys(t,e.missing),r=zs(e.readTime);return Hi.newNoDocument(n,r)}(t,e):ei()}(n.R,t);s.set(e.key.toString(),e)}),a=[],[2,(e.forEach(function(t){var e=s.get(t.toString());ni(!!e),a.push(e)}),a)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new hs(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(P.b)(this,void 0,void 0,function(){var t,e=this;return Object(P.d)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=Ni.fromPath(n);e.mutations.push(new ls(r,e.precondition(r)))}),[4,function(t,e){return Object(P.b)(this,void 0,void 0,function(){var n,r,i;return Object(P.d)(this,function(o){switch(o.label){case 0:return n=ri(t),r=Js(n.R)+"/documents",i={writes:e.map(function(t){return na(n.R,t)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw ei();e=hi.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Wr(Hr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?Yo.updateTime(e):Yo.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(hi.min()))throw new Wr(Hr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Yo.updateTime(e)}return Yo.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),Cl=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new $c(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return Object(P.b)(t,void 0,void 0,function(){var t,e,n=this;return Object(P.d)(this,function(r){return t=new xl(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!ki(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!ds(e)}return!1},t}(),Rl=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=xc.UNAUTHENTICATED,this.clientId=oi.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(t){return Object(P.b)(r,void 0,void 0,function(){return Object(P.d)(this,function(e){switch(e.label){case 0:return $r("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}})})})}return t.prototype.getConfiguration=function(){return Object(P.b)(this,void 0,void 0,function(){return Object(P.d)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Wr(Hr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new qa;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return Object(P.b)(t,void 0,void 0,function(){var t,n;return Object(P.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=Nh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function Pl(t,e){return Object(P.b)(this,void 0,void 0,function(){var n,r,i=this;return Object(P.d)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),$r("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener(function(t){return Object(P.b)(i,void 0,void 0,function(){return Object(P.d)(this,function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,uc(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}})})}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function Ll(t,e){return Object(P.b)(this,void 0,void 0,function(){var n,r;return Object(P.d)(this,function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,Ml(t)];case 1:return n=i.sent(),$r("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener(function(t){return function(t,e){return Object(P.b)(this,void 0,void 0,function(){var n,r;return Object(P.d)(this,function(i){switch(i.label){case 0:return(n=ri(t)).asyncQueue.verifyOperationInProgress(),$r("RemoteStore","RemoteStore received new credentials"),r=fh(n),n.Or.add(3),[4,oh(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,ih(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,t)}),t.onlineComponents=e,[2]}})})}function Ml(t){return Object(P.b)(this,void 0,void 0,function(){return Object(P.d)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:($r("FirestoreClient","Using default OfflineComponentProvider"),[4,Pl(t,new kl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function Ul(t){return Object(P.b)(this,void 0,void 0,function(){return Object(P.d)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:($r("FirestoreClient","Using default OnlineComponentProvider"),[4,Ll(t,new Nl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function Fl(t){return Ml(t).then(function(t){return t.persistence})}function Vl(t){return Ml(t).then(function(t){return t.localStore})}function ql(t){return Ul(t).then(function(t){return t.remoteStore})}function Bl(t){return Ul(t).then(function(t){return t.syncEngine})}function Kl(t){return Object(P.b)(this,void 0,void 0,function(){var e,n;return Object(P.d)(this,function(r){switch(r.label){case 0:return[4,Ul(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=Xh.bind(null,e.syncEngine),n.onUnlisten=Jh.bind(null,e.syncEngine),n)]}})})}function Gl(t,e,n){var r=this;void 0===n&&(n={});var i=new qa;return t.asyncQueue.enqueueAndForget(function(){return Object(P.b)(r,void 0,void 0,function(){var r;return Object(P.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new jl({next:function(o){e.enqueueAndForget(function(){return Mh(t,s)});var a=o.docs.has(n);!a&&o.fromCache?i.reject(new Wr(Hr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new Wr(Hr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new qh(mo(n.path),o,{includeMetadataChanges:!0,so:!0});return Lh(t,s)},[4,Kl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}function zl(t,e,n){var r=this;void 0===n&&(n={});var i=new qa;return t.asyncQueue.enqueueAndForget(function(){return Object(P.b)(r,void 0,void 0,function(){var r;return Object(P.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new jl({next:function(n){e.enqueueAndForget(function(){return Mh(t,s)}),n.fromCache&&"server"===r.source?i.reject(new Wr(Hr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new qh(n,o,{includeMetadataChanges:!0,so:!0});return Lh(t,s)},[4,Kl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}var Ql=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},Hl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),Wl=new Map,Yl=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},Xl=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(xc.UNAUTHENTICATED)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),$l=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Jl=function(){function t(t){var e=this;this.currentUser=xc.UNAUTHENTICATED,this.oc=new qa,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)})};var n=function(t){$r("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit(function(t){return n(t)}),setTimeout(function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):($r("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}},0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?($r("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(ni("string"==typeof n.accessToken),new Yl(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return Object(P.b)(n,void 0,void 0,function(){return Object(P.d)(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}})})})},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return ni(null===t||"string"==typeof t),new xc(t)},t}(),Zl=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=xc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),tf=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new Zl(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(xc.FIRST_PARTY)})},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function ef(t,e,n){if(!n)throw new Wr(Hr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function nf(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function rf(t,e,n,r){if(!0===e&&!0===r)throw new Wr(Hr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function of(t){if(!Ni.isDocumentKey(t))throw new Wr(Hr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function sf(t){if(Ni.isDocumentKey(t))throw new Wr(Hr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function af(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":ei()}function uf(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Wr(Hr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=af(t);throw new Wr(Hr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function cf(t,e){if(e<=0)throw new Wr(Hr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var hf=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Wr(Hr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Wr(Hr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,rf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),lf=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hf({}),this._settingsFrozen=!1,t instanceof Hl?(this._databaseId=t,this._credentials=new Xl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Wr(Hr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Hl(t.options.projectId)}(t),this._credentials=new Jl(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new Wr(Hr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Wr(Hr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hf(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Xl;switch(t.type){case"gapi":var e=t.client;return ni(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new tf(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Wr(Hr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=Wl.get(this))&&($r("ComponentProvider","Removing Datastore"),Wl.delete(this),t.terminate()),Promise.resolve();var t},t}(),ff=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new pf(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),df=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),pf=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,mo(r))||this)._path=r,i.type="collection",i}return Object(P.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new ff(this.firestore,null,new Ni(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(df);function gf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(L.h)(t),ef("collection","path",e),t instanceof lf)return sf(n=gi.fromString.apply(gi,Object(P.f)([e],r))),new pf(t,null,n);if(!(t instanceof ff||t instanceof pf))throw new Wr(Hr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return sf(n=gi.fromString.apply(gi,Object(P.f)([t.path],r)).child(gi.fromString(e))),new pf(t.firestore,null,n)}function yf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(L.h)(t),1===arguments.length&&(e=oi.u()),ef("doc","path",e),t instanceof lf)return of(n=gi.fromString.apply(gi,Object(P.f)([e],r))),new ff(t,null,new Ni(n));if(!(t instanceof ff||t instanceof pf))throw new Wr(Hr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return of(n=t._path.child(gi.fromString.apply(gi,Object(P.f)([e],r)))),new ff(t.firestore,t instanceof pf?t.converter:null,new Ni(n))}function mf(t,e){return t=Object(L.h)(t),e=Object(L.h)(e),(t instanceof ff||t instanceof pf)&&(e instanceof ff||e instanceof pf)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function vf(t,e){return t=Object(L.h)(t),e=Object(L.h)(e),t instanceof df&&e instanceof df&&t.firestore===e.firestore&&So(t._query,e._query)&&t.converter===e.converter}var bf=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=[],this.Zi=new $c(this,"async_queue_retry"),this.Tc=function(){var e=Yc();e&&$r("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=Yc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Tc)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ic(),this.Ac(t)},t.prototype.enterRestrictedMode=function(){if(!this._c){this._c=!0;var t=Yc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Tc)}},t.prototype.enqueue=function(t){return this.Ic(),this._c?new Promise(function(t){}):this.Ac(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.Rc()})},t.prototype.Rc=function(){return Object(P.b)(this,void 0,void 0,function(){var t,e=this;return Object(P.d)(this,function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!Ha(t=n.sent()))throw t;return $r("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return e.Rc()}),n.label=5;case 5:return[2]}})})},t.prototype.Ac=function(t){var e=this,n=this.dc.then(function(){return e.gc=!0,t().catch(function(t){throw e.yc=t,e.gc=!1,Jr("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.gc=!1,t})});return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ic(),this.Ec.indexOf(t)>-1&&(e=0);var i=Ah.createAndSchedule(this,t,e,n,function(t){return r.bc(t)});return this.mc.push(i),i},t.prototype.Ic=function(){this.yc&&ei()},t.prototype.verifyOperationInProgress=function(){},t.prototype.vc=function(){return Object(P.b)(this,void 0,void 0,function(){var t;return Object(P.d)(this,function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Pc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Vc=function(t){var e=this;return this.vc().then(function(){e.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.vc()})},t.prototype.Sc=function(t){this.Ec.push(t)},t.prototype.bc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function wf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new qa,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var Tf=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new bf,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(P.c)(e,t),e.prototype._terminate=function(){return this._firestoreClient||Ef(this),this._firestoreClient.terminate()},e}(lf);function If(t){return t._firestoreClient||Ef(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Ef(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new Ql(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Rl(t._credentials,t._queue,r)}function _f(t,e,n){var r=this,i=new qa;return t.asyncQueue.enqueue(function(){return Object(P.b)(r,void 0,void 0,function(){var r;return Object(P.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,Pl(t,n)];case 1:return o.sent(),[4,Ll(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===Hr.FAILED_PRECONDITION||t.code===Hr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function Of(t){if(t._initialized||t._terminated)throw new Wr(Hr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Sf=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new mi(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),kf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(bi.fromBase64String(e))}catch(e){throw new Wr(Hr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(bi.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Df=function(t){this._methodName=t},Af=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new Wr(Hr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Wr(Hr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return si(this._lat,t._lat)||si(this._long,t._long)},t}(),Nf=/^__.*__$/,jf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new is(t,this.data,this.fieldMask,e,this.fieldTransforms):new rs(t,this.data,e,this.fieldTransforms)},t}(),xf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new is(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function Cf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ei()}}var Rf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Dc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Cc",{get:function(){return this.settings.Cc},enumerable:!1,configurable:!0}),t.prototype.Nc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.xc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Nc({path:n,Fc:!1});return r.kc(t),r},t.prototype.$c=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Nc({path:n,Fc:!1});return r.Dc(),r},t.prototype.Oc=function(t){return this.Nc({path:void 0,Fc:!0})},t.prototype.Mc=function(t){return td(t,this.settings.methodName,this.settings.Lc||!1,this.path,this.settings.Bc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Dc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.kc(this.path.get(t))},t.prototype.kc=function(t){if(0===t.length)throw this.Mc("Document fields must not be empty");if(Cf(this.Cc)&&Nf.test(t))throw this.Mc('Document fields cannot begin and end with "__"')},t}(),Pf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Xc(t)}return t.prototype.qc=function(t,e,n,r){return void 0===r&&(r=!1),new Rf({Cc:t,methodName:e,Bc:n,path:mi.emptyPath(),Fc:!1,Lc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function Lf(t){var e=t._freezeSettings(),n=Xc(t._databaseId);return new Pf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Mf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.qc(o.merge||o.mergeFields?2:0,e,n,i);Xf("Data must be an object, but it was:",s,r);var a,u,c=Wf(r,s);if(o.merge)a=new vi(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=$f(e,f[l],n);if(!s.contains(d))throw new Wr(Hr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");ed(h,d)||h.push(d)}a=new vi(h),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new jf(new zi(c),a,u)}var Uf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(P.c)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Cc)throw t.Mc(1===t.Cc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(Df);function Ff(t,e,n){return new Rf({Cc:3,Bc:e.settings.Bc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var Vf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(P.c)(e,t),e.prototype._toFieldTransform=function(t){return new Ho(t.path,new Fo)},e.prototype.isEqual=function(t){return t instanceof e},e}(Df),qf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return Object(P.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Ff(this,t,!0),n=this.Uc.map(function(t){return Hf(t,e)}),r=new Vo(n);return new Ho(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Df),Bf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return Object(P.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Ff(this,t,!0),n=this.Uc.map(function(t){return Hf(t,e)}),r=new Bo(n);return new Ho(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Df),Kf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(P.c)(e,t),e.prototype._toFieldTransform=function(t){var e=new Go(t.R,Ro(t.R,this.Kc));return new Ho(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(Df);function Gf(t,e,n,r){var i=t.qc(1,e,n);Xf("Data must be an object, but it was:",i,r);var o=[],s=zi.empty();fi(r,function(t,r){var a=Zf(e,t,n);r=Object(L.h)(r);var u=i.$c(a);if(r instanceof Uf)o.push(a);else{var c=Hf(r,u);null!=c&&(o.push(a),s.set(a,c))}});var a=new vi(o);return new xf(s,a,i.fieldTransforms)}function zf(t,e,n,r,i,o){var s=t.qc(1,e,n),a=[$f(e,r,n)],u=[i];if(o.length%2!=0)throw new Wr(Hr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push($f(e,o[c])),u.push(o[c+1]);for(var h=[],l=zi.empty(),f=a.length-1;f>=0;--f)if(!ed(h,a[f])){var d=a[f],p=u[f];p=Object(L.h)(p);var g=s.$c(d);if(p instanceof Uf)h.push(d);else{var y=Hf(p,g);null!=y&&(h.push(d),l.set(d,y))}}var m=new vi(h);return new xf(l,m,s.fieldTransforms)}function Qf(t,e,n,r){return void 0===r&&(r=!1),Hf(n,t.qc(r?4:3,e))}function Hf(t,e){if(Yf(t=Object(L.h)(t)))return Xf("Unsupported field value:",e,t),Wf(t,e);if(t instanceof Df)return function(t,e){if(!Cf(e.Cc))throw e.Mc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Mc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Cc)throw e.Mc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Hf(o[i],e.Oc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(L.h)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Ro(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=ci.fromDate(t);return{timestampValue:Bs(e.R,n)}}if(t instanceof ci)return n=new ci(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:Bs(e.R,n)};if(t instanceof Af)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof kf)return{bytesValue:Ks(e.R,t._byteString)};if(t instanceof ff){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Mc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Qs(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Mc("Unsupported field value: "+af(t))}(t,e)}function Wf(t,e){var n={};return di(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):fi(t,function(t,r){var i=Hf(r,e.xc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Yf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ci||t instanceof Af||t instanceof kf||t instanceof ff||t instanceof Df)}function Xf(t,e,n){if(!Yf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=af(n);throw e.Mc("an object"===r?t+" a custom object":t+" "+r)}}function $f(t,e,n){if((e=Object(L.h)(e))instanceof Sf)return e._internalPath;if("string"==typeof e)return Zf(t,e);throw td("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Jf=new RegExp("[~\\*/\\[\\]]");function Zf(t,e,n){if(e.search(Jf)>=0)throw td("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Sf.bind.apply(Sf,Object(P.f)([void 0],e.split(".")))))._internalPath}catch(tp){throw td("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function td(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new Wr(Hr.INVALID_ARGUMENT,(a+=". ")+t+u)}function ed(t,e){return t.some(function(t){return t.isEqual(e)})}var nd=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new ff(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new rd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(id("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),rd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(P.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(nd);function id(t,e){return"string"==typeof e?Zf(t,e):e instanceof Sf?e._internalPath:e._delegate._internalPath}var od=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),sd=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return Object(P.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new ad(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(id("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(nd),ad=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(P.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(sd),ud=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new od(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new ad(n._firestore,n._userDataWriter,r.key,r,new od(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Wr(Hr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new ad(t._firestore,t._userDataWriter,e.doc.key,e.doc,new od(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new ad(t._firestore,t._userDataWriter,e.doc.key,e.doc,new od(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:cd(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function cd(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ei()}}function hd(t,e){return t instanceof sd&&e instanceof sd?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof ud&&e instanceof ud&&t._firestore===e._firestore&&vf(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function ld(t){if(bo(t)&&0===t.explicitOrderBy.length)throw new Wr(Hr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var fd=function(){};function dd(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var pd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qc=e,i.jc=n,i.Wc=r,i.type="where",i}return Object(P.c)(e,t),e.prototype._apply=function(t){var e=Lf(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Td(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(wd(r,t,h[c]));a={arrayValue:{values:u}}}else a=wd(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Td(s,o),a=Qf(n,"where",s,"in"===o||"not-in"===o);var l=Zi.create(i,o,a);return function(t,e){if(e.g()){var n=To(t);if(null!==n&&!n.isEqual(e.field))throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=wo(t);null!==r&&Id(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new Wr(Hr.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.Qc,this.jc,this.Wc);return new df(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new go(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(fd),gd=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Qc=e,r.Gc=n,r.type="orderBy",r}return Object(P.c)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new ho(e,n);return function(t,e){if(null===wo(t)){var n=To(t);null!==n&&Id(0,n,e.field)}}(t,r),r}(t._query,this.Qc,this.Gc);return new df(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new go(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(fd),yd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.zc=n,i.Hc=r,i}return Object(P.c)(e,t),e.prototype._apply=function(t){return new df(t.firestore,t.converter,Oo(t._query,this.zc,this.Hc))},e}(fd),md=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Jc=n,i.Yc=r,i}return Object(P.c)(e,t),e.prototype._apply=function(t){var e=bd(t,this.type,this.Jc,this.Yc);return new df(t.firestore,t.converter,function(t,e){return new go(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(fd),vd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Jc=n,i.Yc=r,i}return Object(P.c)(e,t),e.prototype._apply=function(t){var e=bd(t,this.type,this.Jc,this.Yc);return new df(t.firestore,t.converter,function(t,e){return new go(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(fd);function bd(t,e,n,r){if(n[0]=Object(L.h)(n[0]),n[0]instanceof nd)return function(t,e,n,r,i){if(!r)throw new Wr(Hr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=Eo(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(Ui(e,r.key));else{var c=r.data.field(u.field);if(_i(c))throw new Wr(Hr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new uo(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=Lf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Wr(Hr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Io(t)&&-1!==c.indexOf("/"))throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(gi.fromString(c));if(!Ni.isDocumentKey(h))throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new Ni(h);a.push(Ui(e,l))}else{var f=Qf(n,r,c);a.push(f)}}return new uo(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function wd(t,e,n){if("string"==typeof(n=Object(L.h)(n))){if(""===n)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Io(e)&&-1!==n.indexOf("/"))throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(gi.fromString(n));if(!Ni.isDocumentKey(r))throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Ui(t,new Ni(r))}if(n instanceof ff)return Ui(t,n._key);throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+af(n)+".")}function Td(t,e){if(!Array.isArray(t)||0===t.length)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Id(t,e,n){if(!n.isEqual(e))throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var Ed=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),ji(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ii(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Ei(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw ei()}},t.prototype.convertObject=function(t,e){var n=this,r={};return fi(t.fields,function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new Af(Ii(t.latitude),Ii(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=Oi(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Si(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=Ti(t);return new ci(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=gi.fromString(t);ni(ma(n));var r=new Hl(n.get(1),n.get(3)),i=new Ni(n.popFirst(5));return r.isEqual(e)||Jr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function _d(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Od=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(P.c)(e,t),e.prototype.convertBytes=function(t){return new kf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new ff(this.firestore,null,e)},e}(Ed),Sd=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Lf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=kd(t,this._firestore),i=_d(r.converter,e,n),o=Mf(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,Yo.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=kd(t,this._firestore);return o="string"==typeof(e=Object(L.h)(e))||e instanceof Sf?zf(this._dataReader,"WriteBatch.update",s._key,e,n,r):Gf(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,Yo.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=kd(t,this._firestore);return this._mutations=this._mutations.concat(new hs(e._key,Yo.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new Wr(Hr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function kd(t,e){if((t=Object(L.h)(t)).firestore!==e)throw new Wr(Hr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Dd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(P.c)(e,t),e.prototype.convertBytes=function(t){return new kf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new ff(this.firestore,null,e)},e}(Ed);function Ad(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=uf(t,ff);var o=uf(t.firestore,Tf),s=Lf(o);return jd(o,[("string"==typeof(e=Object(L.h)(e))||e instanceof Sf?zf(s,"updateDoc",t._key,e,n,r):Gf(s,"updateDoc",t._key,e)).toMutation(t._key,Yo.exists(!0))])}function Nd(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=Object(L.h)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||wf(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(wf(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof ff)c=uf(t.firestore,Tf),h=mo(t._key.path),u={next:function(e){i[a]&&i[a](xd(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=uf(t,df);c=uf(d.firestore,Tf),h=d._query;var p=new Dd(c);u={next:function(t){i[a]&&i[a](new ud(c,p,d,t))},error:i[a+1],complete:i[a+2]},ld(t._query)}return function(t,e,n,r){var i=this,o=new jl(r),s=new qh(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return Object(P.b)(i,void 0,void 0,function(){var e;return Object(P.d)(this,function(n){switch(n.label){case 0:return e=Lh,[4,Kl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})}),function(){o.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(P.b)(i,void 0,void 0,function(){var e;return Object(P.d)(this,function(n){switch(n.label){case 0:return e=Mh,[4,Kl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})})}}(If(c),h,l,u)}function jd(t,e){return function(t,e){var n=this,r=new qa;return t.asyncQueue.enqueueAndForget(function(){return Object(P.b)(n,void 0,void 0,function(){var n;return Object(P.d)(this,function(i){switch(i.label){case 0:return n=Zh,[4,Bl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(If(t),e)}function xd(t,e,n){var r=n.docs.get(e._key),i=new Dd(t);return new sd(t,i,e._key,r,new od(n.hasPendingWrites,n.fromCache),e.converter)}var Cd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(P.c)(e,t),e.prototype.get=function(e){var n=this,r=kd(e,this._firestore),i=new Dd(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new sd(n._firestore,i,r._key,t._document,new od(!1,!1),r.converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=Lf(t)}return t.prototype.get=function(t){var e=this,n=kd(t,this._firestore),r=new Od(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return ei();var i=t[0];if(i.isFoundDocument())return new nd(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new nd(e._firestore,r,n._key,null,n.converter);throw ei()})},t.prototype.set=function(t,e,n){var r=kd(t,this._firestore),i=_d(r.converter,e,n),o=Mf(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=kd(t,this._firestore);return o="string"==typeof(e=Object(L.h)(e))||e instanceof Sf?zf(this._dataReader,"Transaction.update",s._key,e,n,r):Gf(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=kd(t,this._firestore);return this._transaction.delete(e._key),this},t}());function Rd(){if("undefined"==typeof Uint8Array)throw new Wr(Hr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Pd(){if("undefined"==typeof atob)throw new Wr(Hr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Ld=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return Pd(),new t(kf.fromBase64String(e))},t.fromUint8Array=function(e){return Rd(),new t(kf.fromUint8Array(e))},t.prototype.toBase64=function(){return Pd(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return Rd(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),Md=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Of(t=uf(t,Tf));var n=If(t),r=t._freezeSettings(),i=new Nl;return _f(n,i,new Dl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Of(t=uf(t,Tf));var e=If(t),n=t._freezeSettings(),r=new Nl;return _f(e,r,new Al(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new Wr(Hr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new qa;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return Object(P.b)(e,void 0,void 0,function(){var e;return Object(P.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(P.b)(this,void 0,void 0,function(){return Object(P.d)(this,function(e){switch(e.label){case 0:return Ga.yt()?[4,Ga.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(ec(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),Ud=function(){function t(t,e,n){var r=this;this._delegate=e,this.Xc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof Hl||(this.Zc=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||Zr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});var i=(t=uf(t,lf))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Zr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){var o=Object(L.d)(r.mockUserToken),s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Wr(Hr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new $l(new Yl(o,new xc(s)))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(P.b)(e,void 0,void 0,function(){var e,n;return Object(P.d)(this,function(r){switch(r.label){case 0:return[4,Fl(t)];case 1:return e=r.sent(),[4,ql(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=ri(t);return e.Or.delete(0),ih(e)}(n))]}})})})}(If(uf(this._delegate,Tf)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(P.b)(e,void 0,void 0,function(){var e,n;return Object(P.d)(this,function(r){switch(r.label){case 0:return[4,Fl(t)];case 1:return e=r.sent(),[4,ql(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(P.b)(this,void 0,void 0,function(){var e;return Object(P.d)(this,function(n){switch(n.label){case 0:return(e=ri(t)).Or.add(0),[4,oh(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(If(uf(this._delegate,Tf)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&rf("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Xc.enableMultiTabIndexedDbPersistence(this):this.Xc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Xc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.Zc&&(this.Zc._removeServiceInstance("firestore"),this.Zc._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new qa;return t.asyncQueue.enqueueAndForget(function(){return Object(P.b)(e,void 0,void 0,function(){var e;return Object(P.d)(this,function(r){switch(r.label){case 0:return e=ol,[4,Bl(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(If(uf(this._delegate,Tf)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new jl(e);return t.asyncQueue.enqueueAndForget(function(){return Object(P.b)(n,void 0,void 0,function(){var e;return Object(P.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){ri(t).Gr.add(e),e.next()},[4,Kl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(P.b)(n,void 0,void 0,function(){var e;return Object(P.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){ri(t).Gr.delete(e)},[4,Kl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(If(t=uf(t,Tf)),wf(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Zc)throw new Wr(Hr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Zc},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Jd(this,gf(this._delegate,t))}catch(t){throw Gd(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new Kd(this,yf(this._delegate,t))}catch(t){throw Gd(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new Yd(this,function(t,e){if(t=uf(t,lf),ef("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new df(t,null,function(t){return new go(gi.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw Gd(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new qa;return t.asyncQueue.enqueueAndForget(function(){return Object(P.b)(n,void 0,void 0,function(){var n;return Object(P.d)(this,function(i){switch(i.label){case 0:return[4,function(t){return Ul(t).then(function(t){return t.datastore})}(t)];case 1:return n=i.sent(),new Cl(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(If(t),function(n){return e(new Cd(t,n))})}(this._delegate,function(n){return t(new Vd(e,n))})},t.prototype.batch=function(){var t=this;return If(this._delegate),new qd(new Sd(this._delegate,function(e){return jd(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new Wr(Hr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new Wr(Hr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),Fd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(P.c)(e,t),e.prototype.convertBytes=function(t){return new Ld(new kf(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return Kd.tu(e,this.firestore,null)},e}(Ed),Vd=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Fd(t)}return t.prototype.get=function(t){var e=this,n=Zd(t);return this._delegate.get(n).then(function(t){return new Hd(e._firestore,new sd(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=Zd(t);return n?(nf("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Zd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(P.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Zd(t);return this._delegate.delete(e),this},t}(),qd=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Zd(t);return n?(nf("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Zd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(P.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Zd(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),Bd=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new ad(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Wd(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.eu=function(e,n){var r=t.nu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new Fd(e),n),i.set(n,o)),o},t}();Bd.nu=new WeakMap;var Kd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Fd(t)}return t.su=function(e,n,r){if(e.length%2!=0)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new ff(n._delegate,r,new Ni(e)))},t.tu=function(e,n,r){return new t(n,new ff(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Jd(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Jd(this.firestore,gf(this._delegate,t))}catch(t){throw Gd(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(L.h)(t))instanceof ff&&mf(this._delegate,t)},t.prototype.set=function(t,e){e=nf("DocumentReference.set",e);try{return function(t,e,n){t=uf(t,ff);var r=uf(t.firestore,Tf),i=_d(t.converter,e,n);return jd(r,[Mf(Lf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Yo.none())])}(this._delegate,t,e)}catch(t){throw Gd(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Ad(this._delegate,t):Ad.apply(void 0,Object(P.f)([this._delegate,t,e],n))}catch(t){throw Gd(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return jd(uf((t=this._delegate).firestore,Tf),[new hs(t._key,Yo.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=zd(e),i=Qd(e,function(e){return new Hd(t.firestore,new sd(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return Nd(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=uf(t,ff);var e=uf(t.firestore,Tf),n=If(e),r=new Dd(e);return function(t,e){var n=this,r=new qa;return t.asyncQueue.enqueueAndForget(function(){return Object(P.b)(n,void 0,void 0,function(){var n;return Object(P.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(P.b)(this,void 0,void 0,function(){var r,i;return Object(P.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=ri(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new Wr(Hr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=Nh(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,Vl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._key).then(function(n){return new sd(e,r,t._key,n,new od(null!==n&&n.hasLocalMutations,!0),t.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=uf(t,ff);var e=uf(t.firestore,Tf);return Gl(If(e),t._key,{source:"server"}).then(function(n){return xd(e,t,n)})}(this._delegate):function(t){t=uf(t,ff);var e=uf(t.firestore,Tf);return Gl(If(e),t._key).then(function(n){return xd(e,t,n)})}(this._delegate)).then(function(t){return new Hd(e.firestore,new sd(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Bd.eu(this.firestore,e):null))},t}();function Gd(t,e,n){return t.message=t.message.replace(e,n),t}function zd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!wf(r))return r}return{}}function Qd(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=wf(t[0])?t[0]:wf(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var Hd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new Kd(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return hd(this._delegate,t._delegate)},t}(),Wd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(P.c)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(Hd),Yd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Fd(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,dd(this._delegate,function(t,e,n){var r=e,i=id("where",t);return new pd(i,r,n)}(e,n,r)))}catch(e){throw Gd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,dd(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=id("orderBy",t);return new gd(r,n)}(e,n)))}catch(e){throw Gd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,dd(this._delegate,function(t){return cf("limit",t),new yd("limit",t,"F")}(e)))}catch(e){throw Gd(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,dd(this._delegate,function(t){return cf("limitToLast",t),new yd("limitToLast",t,"L")}(e)))}catch(e){throw Gd(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,dd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new md("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw Gd(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,dd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new md("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw Gd(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,dd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new vd("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw Gd(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,dd(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new vd("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw Gd(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return vf(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=uf(t,df);var e=uf(t.firestore,Tf),n=If(e),r=new Dd(e);return function(t,e){var n=this,r=new qa;return t.asyncQueue.enqueueAndForget(function(){return Object(P.b)(n,void 0,void 0,function(){var n;return Object(P.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(P.b)(this,void 0,void 0,function(){var r,i,o,s,a;return Object(P.d)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,yc(t,e,!0)];case 1:return a=u.sent(),r=new Qh(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=Nh(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}})})},[4,Vl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._query).then(function(n){return new ud(e,r,t,n)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=uf(t,df);var e=uf(t.firestore,Tf),n=If(e),r=new Dd(e);return zl(n,t._query,{source:"server"}).then(function(n){return new ud(e,r,t,n)})}(this._delegate):function(t){t=uf(t,df);var e=uf(t.firestore,Tf),n=If(e),r=new Dd(e);return ld(t._query),zl(n,t._query).then(function(n){return new ud(e,r,t,n)})}(this._delegate)).then(function(t){return new $d(e.firestore,new ud(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=zd(e),i=Qd(e,function(e){return new $d(t.firestore,new ud(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return Nd(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Bd.eu(this.firestore,e):null))},t}(),Xd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new Wd(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),$d=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new Yd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new Wd(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new Xd(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new Wd(n._firestore,r))})},t.prototype.isEqual=function(t){return hd(this._delegate,t._delegate)},t}(),Jd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(P.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Kd(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new Kd(this.firestore,void 0===t?yf(this._delegate):yf(this._delegate,t))}catch(t){throw Gd(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=uf(t.firestore,Tf),r=yf(t),i=_d(t.converter,e);return jd(n,[Mf(Lf(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,Yo.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new Kd(e.firestore,t)})},e.prototype.isEqual=function(t){return mf(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?Bd.eu(this.firestore,t):null))},e}(Yd);function Zd(t){return uf(t,ff)}var tp,ep=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Sf.bind.apply(Sf,Object(P.f)([void 0],t)))}return t.documentId=function(){return new t(mi.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(L.h)(t))instanceof Sf&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),np=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new Vf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new Uf("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new qf("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Bf("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new Kf("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),rp=n("/6Yf"),ip={Firestore:Ud,GeoPoint:Af,Timestamp:ci,Blob:Ld,Transaction:Vd,WriteBatch:qd,DocumentReference:Kd,DocumentSnapshot:Hd,Query:Yd,QueryDocumentSnapshot:Wd,QuerySnapshot:$d,CollectionReference:Jd,FieldPath:ep,FieldValue:np,setLogLevel:function(t){Yr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new rp.a("firestore",function(t){return function(t,e){return new Ud(t,new Tf(t,e),new Md)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},ip)))})(tp=R.a),tp.registerVersion("@firebase/firestore","2.3.8");var op=n("UbJi");function sp(t,e){return function(t,e=T.b){return new I.a(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function ap(t,e){return sp(t,e).pipe(Object(k.a)(t=>({payload:t,type:"query"})))}function up(t,e){return ap(t,e).pipe(Object(O.a)(void 0),Object(S.a)(),Object(k.a)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),s=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function cp(t,e,n){return up(t,n).pipe(Object(D.a)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return hp(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return hp(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return hp(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),Object(A.a)(),Object(k.a)(t=>t.map(t=>({type:t.type,payload:t}))))}function hp(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function lp(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}class fp{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=up(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Object(k.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe(Object(O.a)(void 0),Object(S.a)(),Object(N.a)(([t,e])=>e.length>0||!t),Object(k.a)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(D.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=lp(t);return cp(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return ap(this.query,this.afs.schedulers.outsideAngular).pipe(Object(k.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(E.a)(this.query.get(t)).pipe(Object(j.b)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new dp(this.ref.doc(t),this.afs)}}class dp{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=bp(n,e);return new fp(r,i,this.afs)}snapshotChanges(){return sp(this.ref,this.afs.schedulers.outsideAngular).pipe(Object(O.a)(void 0),Object(S.a)(),Object(k.a)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe(Object(k.a)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Object(E.a)(this.ref.get(t)).pipe(Object(j.b)(this.afs.schedulers.insideAngular))}}class pp{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?up(this.query,this.afs.schedulers.outsideAngular).pipe(Object(k.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)),Object(N.a)(t=>t.length>0),this.afs.keepUnstableUntilFirst):up(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(D.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=lp(t);return cp(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return ap(this.query,this.afs.schedulers.outsideAngular).pipe(Object(k.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(E.a)(this.query.get(t)).pipe(Object(j.b)(this.afs.schedulers.insideAngular))}}const gp=new i.s("angularfire2.enableFirestorePersistence"),yp=new i.s("angularfire2.firestore.persistenceSettings"),mp=new i.s("angularfire2.firestore.settings"),vp=new i.s("angularfire2.firestore.use-emulator");function bp(t,e=(t=>t)){return{query:e(t),ref:t}}let wp=(()=>{class t{constructor(t,e,n,i,o,s,a,u,c){this.schedulers=new x.d(s),this.keepUnstableUntilFirst=Object(x.h)(this.schedulers);const h=Object(x.g)(t,s,e);!C.a.auth&&c&&Object(x.j)();const l=u;[this.firestore,this.persistenceEnabled$]=Object(x.f)(`${h.name}.firestore`,"AngularFirestore",h,()=>{const t=s.runOutsideAngular(()=>h.firestore());if(i&&t.settings(i),l&&t.useEmulator(...l),n&&!Object(r.u)(o)){const e=()=>{try{return Object(E.a)(t.enablePersistence(a||void 0).then(()=>!0,()=>!1))}catch(tp){return"undefined"!=typeof console&&console.warn(tp),Object(_.a)(!1)}};return[t,s.runOutsideAngular(e)]}return[t,Object(_.a)(!1)]},[i,l,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=bp(n,e),o=this.schedulers.ngZone.run(()=>r);return new fp(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new pp(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new dp(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(i.Yb(x.c),i.Yb(x.b,8),i.Yb(gp,8),i.Yb(mp,8),i.Yb(i.D),i.Yb(i.B),i.Yb(yp,8),i.Yb(vp,8),i.Yb(op.b,8))},t.\u0275prov=i.Kb({factory:function(){return new t(i.Yb(x.c),i.Yb(x.b,8),i.Yb(gp,8),i.Yb(mp,8),i.Yb(i.D),i.Yb(i.B),i.Yb(yp,8),i.Yb(vp,8),i.Yb(op.b,8))},token:t,providedIn:"any"}),t})();var Tp=n("kmnG"),Ip=n("qFsG"),Ep=n("3Pt+");let _p=(()=>{class t{constructor(t,e,n,r){this.dialogRef=t,this.data=e,this.db=n,this.auth=r,this.userData={}}ngOnInit(){this.auth.user.subscribe(t=>{this.userData=t})}saveData(){if(this.loading=!0,null==this.data.id){let t=(new Date).getTime().toString();this.data.uid=this.userData.uid,this.db.collection("books").doc(t).set(this.data).then(t=>{this.dialogRef.close(this.data),this.loading=!1}).catch(t=>{console.log(t),this.loading=!1,alert("Tidak Dapat Menyimpan Data")})}else this.db.collection("books/").doc(this.data.id).update(this.data).then(t=>{this.dialogRef.close(this.data),this.loading=!1}).catch(t=>{console.log(t),this.loading=!1,alert("Tidak Dapat Mengupdate Data")})}}return t.\u0275fac=function(e){return new(e||t)(i.Ob(w.g),i.Ob(w.a),i.Ob(wp),i.Ob(op.a))},t.\u0275cmp=i.Ib({type:t,selectors:[["app-product-detail"]],decls:28,vars:7,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["appearance","outline",2,"width","100%"],["matInput","",3,"ngModel","ngModelChange"],["mat-dialog-actions","","align","end"],["mat-button","","mat-dialog-close",""],["mat-flat-button","",3,"disabled","click"]],template:function(t,e){1&t&&(i.Ub(0,"h3",0),i.yc(1," Detail Produk "),i.Tb(),i.Ub(2,"div",1),i.Ub(3,"mat-form-field",2),i.Ub(4,"mat-label"),i.yc(5,"Judul"),i.Tb(),i.Ub(6,"input",3),i.bc("ngModelChange",function(t){return e.data.title=t}),i.Tb(),i.Tb(),i.Ub(7,"mat-form-field",2),i.Ub(8,"mat-label"),i.yc(9,"Penyanyi"),i.Tb(),i.Ub(10,"input",3),i.bc("ngModelChange",function(t){return e.data.Singer=t}),i.Tb(),i.Tb(),i.Ub(11,"mat-form-field",2),i.Ub(12,"mat-label"),i.yc(13,"Penulis"),i.Tb(),i.Ub(14,"input",3),i.bc("ngModelChange",function(t){return e.data.author=t}),i.Tb(),i.Tb(),i.Ub(15,"mat-form-field",2),i.Ub(16,"mat-label"),i.yc(17,"Tahun Rilis"),i.Tb(),i.Ub(18,"input",3),i.bc("ngModelChange",function(t){return e.data.year=t}),i.Tb(),i.Tb(),i.Ub(19,"mat-form-field",2),i.Ub(20,"mat-label"),i.yc(21,"Genre"),i.Tb(),i.Ub(22,"input",3),i.bc("ngModelChange",function(t){return e.data.Genre=t}),i.Tb(),i.Tb(),i.Tb(),i.Ub(23,"div",4),i.Ub(24,"button",5),i.yc(25,"Batal"),i.Tb(),i.Ub(26,"button",6),i.bc("click",function(){return e.saveData()}),i.yc(27),i.Tb(),i.Tb()),2&t&&(i.Db(6),i.kc("ngModel",e.data.title),i.Db(4),i.kc("ngModel",e.data.Singer),i.Db(4),i.kc("ngModel",e.data.author),i.Db(4),i.kc("ngModel",e.data.year),i.Db(4),i.kc("ngModel",e.data.Genre),i.Db(4),i.kc("disabled",e.loading),i.Db(1),i.zc(e.loading?"Menyimpan..":"Simpan"))},directives:[w.h,w.e,Tp.b,Tp.e,Ip.b,Ep.c,Ep.j,Ep.l,w.c,a.a,w.d],styles:["body[_ngcontent-%COMP%]{background-image:url(https://p4.wallpaperbetter.com/wallpaper/868/782/385/colorful-black-background-musical-notes-hd-wallpaper-preview.jpg)}"]}),t})();var Op=n("Xa2L"),Sp=n("Wp6s");function kp(t,e){1&t&&(i.Ub(0,"div",2),i.Pb(1,"mat-spinner"),i.Tb())}function Dp(t,e){if(1&t){const t=i.Vb();i.Ub(0,"tr"),i.Pb(1,"td"),i.Ub(2,"td"),i.yc(3),i.Tb(),i.Ub(4,"td"),i.yc(5),i.Tb(),i.Ub(6,"td"),i.yc(7),i.Tb(),i.Ub(8,"td"),i.yc(9),i.Tb(),i.Ub(10,"td"),i.yc(11),i.Tb(),i.Ub(12,"td"),i.yc(13),i.Tb(),i.Pb(14,"td",7),i.Ub(15,"td"),i.Ub(16,"button",9),i.bc("click",function(){i.rc(t);const n=e.$implicit,r=e.index;return i.fc(2).ProductDetail(n,r)}),i.yc(17,"Edit"),i.Tb(),i.Ub(18,"button",10),i.bc("click",function(){i.rc(t);const n=e.$implicit,r=e.index;return i.fc(2).DeleteProduct(n.id,r)}),i.yc(19),i.Tb(),i.Tb(),i.Tb()}if(2&t){const t=e.$implicit,n=e.index,r=i.fc(2);i.Db(3),i.zc(n+1),i.Db(2),i.zc(t.title),i.Db(2),i.zc(t.Singer),i.Db(2),i.zc(t.author),i.Db(2),i.zc(t.year),i.Db(2),i.zc(t.Genre),i.Db(5),i.kc("disabled",r.loadingDelete[n]),i.Db(1),i.zc(r.loadingDelete[n]?"Menghapus..":"Delete")}}function Ap(t,e){if(1&t){const t=i.Vb();i.Ub(0,"mat-card"),i.Ub(1,"mat-card-header"),i.Ub(2,"mat-card-title"),i.yc(3),i.Tb(),i.Tb(),i.Ub(4,"mat-card-content"),i.Ub(5,"div",3),i.Pb(6,"span",4),i.Ub(7,"button",5),i.bc("click",function(){return i.rc(t),i.fc().ProductDetail({},-1)}),i.yc(8,"Tambah"),i.Tb(),i.Tb(),i.Ub(9,"table",6),i.Ub(10,"thead"),i.Pb(11,"th"),i.Ub(12,"th"),i.yc(13,"No"),i.Tb(),i.Ub(14,"th"),i.yc(15,"Judul"),i.Tb(),i.Ub(16,"th"),i.yc(17,"Penyanyi"),i.Tb(),i.Ub(18,"th"),i.yc(19,"Penulis"),i.Tb(),i.Ub(20,"th"),i.yc(21,"Tahun Rilis"),i.Tb(),i.Ub(22,"th"),i.yc(23,"Genre"),i.Tb(),i.Pb(24,"th",7),i.Tb(),i.Ub(25,"tbody"),i.xc(26,Dp,20,8,"tr",8),i.Tb(),i.Tb(),i.Tb(),i.Tb()}if(2&t){const t=i.fc();i.Db(3),i.zc(t.title),i.Db(23),i.kc("ngForOf",t.books)}}const Np=[{path:"",component:y,children:[{path:"dashboard",component:m},{path:"images",component:b},{path:"product",component:(()=>{class t{constructor(t,e,n){this.dialog=t,this.auth=e,this.db=n,this.books={},this.userData={},this.loadingDelete={}}ngOnInit(){this.title="Musik",this.auth.user.subscribe(t=>{this.userData=t,this.getBooks()})}getBooks(){this.loading=!0,this.db.collection("books",t=>t.where("uid","==",this.userData.uid)).valueChanges({idField:"id"}).subscribe(t=>{console.log(t),this.books=t,this.loading=!1},t=>{this.loading=!1})}ProductDetail(t,e){this.dialog.open(_p,{width:"400px",data:t}).afterClosed().subscribe(t=>{})}DeleteProduct(t,e){confirm("Delete item?")&&this.db.collection("books").doc(t).delete().then(t=>{this.books.splice(e,1),this.loadingDelete[e]=!1}).catch(t=>{this.loadingDelete[e]=!1,alert("Tidak dapat menghapus data")})}}return t.\u0275fac=function(e){return new(e||t)(i.Ob(w.b),i.Ob(op.a),i.Ob(wp))},t.\u0275cmp=i.Ib({type:t,selectors:[["app-product"]],decls:2,vars:2,consts:[["style","height: 300px;","class","uk-flex uk-flex-center uk-flex-middle",4,"ngIf"],[4,"ngIf"],[1,"uk-flex","uk-flex-center","uk-flex-middle",2,"height","300px"],[1,"uk-flex"],[1,"uk-width-expand"],["mat-flat-button","","color","primary",3,"click"],[1,"uk-table","uk-table-middle","uk-table-divider"],["align","right"],[4,"ngFor","ngForOf"],["mat-button","","color","primary",3,"click"],["mat-button","","color","accent",3,"disabled","click"]],template:function(t,e){1&t&&(i.xc(0,kp,2,0,"div",0),i.xc(1,Ap,27,2,"mat-card",1)),2&t&&(i.kc("ngIf",e.loading),i.Db(1),i.kc("ngIf",!e.loading))},directives:[r.k,Op.b,Sp.a,Sp.c,Sp.e,Sp.b,a.a,r.j],styles:["body[_ngcontent-%COMP%]{background-image:url(https://p4.wallpaperbetter.com/wallpaper/868/782/385/colorful-black-background-musical-notes-hd-wallpaper-preview.jpg)}"]}),t})()},{path:"",pathMatch:"full",redirectTo:"/admin/dashboard"}]}];let jp=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.Mb({type:t}),t.\u0275inj=i.Lb({imports:[[r.c,o.c.forChild(Np),v.a,Ep.f]]}),t})()}}]);